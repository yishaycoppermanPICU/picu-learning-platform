#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
הוספת תוכן: סטרואידים (Steroids)
"""

from utils.database import init_supabase, create_content_item, create_content_section

def add_steroids():
    """הוספת תרופות סטרואידים"""
    
    print("🔄 מתחבר למסד הנתונים...")
    supabase = init_supabase()
    
    if not supabase:
        print("❌ שגיאה בחיבור למסד נתונים")
        return False
    
    print("✅ חיבור הצליח!")
    
    # יצירת הנושא הראשי
    print("\n📝 יוצר נושא: סטרואידים...")
    
    topic_data = {
        "title": "סטרואידים - Steroids",
        "category": "medications",
        "description": "מדריך מקיף לסטרואידים: דקסמתזון, סולומדרול, הידרוקורטיזון, פרדניזולון, פרדניזון",
        "icon": "💊",
        "slug": "steroids",
        "tags": ["תרופות", "סטרואידים", "דקסמתזון", "סולומדרול", "הידרוקורטיזון", "פרדניזולון", "קורטיקוסטרואידים"],
        "order_index": 8
    }
    
    topic = create_content_item(topic_data)
    
    if not topic:
        print("❌ שגיאה ביצירת הנושא")
        return False
    
    topic_id = topic['id']
    print(f"✅ נושא נוצר בהצלחה! ID: {topic_id}")
    
    # הוספת מקטעים
    sections = [
        {
            "title": "דקסמתזון - Dexamethasone",
            "section_type": "text",
            "content": """**Dexamethasone - דקסמתזון**

**משפחה:** גלוקוקורטיקואיד (Glucocorticoid)

**תיאור:**
סטרואיד חזק וארוך טווח, אנטי-דלקתי ואימונוסופרסיבי

---

**📊 מינון:**

**קרופ (Croup):**
💉 **0.6 mg/kg/dose** PO/IM/IV (מנה אחת)
- מקסימום: **10 mg**
- יעיל ל-48-72 שעות!

**אסטמה חריפה:**
💉 **0.6 mg/kg/dose** PO/IM/IV (מנה אחת)
- מקסימום: **16 mg**
- חלופה: 0.3 mg/kg/day למשך 2 ימים

**בצקת מוחית/ICP גבוה:**
💉 **מנת העמסה:** 1-2 mg/kg
💧 **תחזוקה:** 0.5-1 mg/kg/day חלוקה ל-2-4 מנות
- מקסימום: **16 mg/day**

**דלקת קרום המוח חיידקית:**
💉 **0.15 mg/kg/dose** כל **6 שעות** למשך **2-4 ימים**
- להתחיל **לפני** או **עם** האנטיביוטיקה הראשונה

**בחילות והקאות (מכימותרפיה):**
💉 **5-20 mg/dose**

**הלם ספטי (שנוי במחלוקת):**
💉 **0.5-1 mg/kg/dose** או **5-10 mg**

---

**🎯 התוויות:**

✅ **קרופ** - **בחירה ראשונה!**
✅ **אסטמה חריפה**
✅ **בצקת מוחית/ICP גבוה**
✅ **דלקת קרום המוח חיידקית** (מניעת סיבוכים)
✅ **בחילות והקאות** (כימותרפיה)
✅ **אלרגיה חמורה / אנפילקסיס**
✅ **אי-ספיקת אדרנל**

---

**⏱️ פרמקולוגיה:**

**תחילת השפעה:**
- PO: **1-2 שעות**
- IV: **זריז יותר**

**משך השפעה:**
- **36-72 שעות** (ארוך מאוד!)

**זמן מחצית חיים:**
- **36-72 שעות**

**עוצמה יחסית:**
- פי **25-30** מהידרוקורטיזון
- פי **5-7** מפרדניזולון

---

**⚠️ תופעות לוואי:**

**חריפות (מנות בודדות):**
- עלייה בסוכר
- שינויים במצב רוח (אופוריה/עצבנות)
- נדיר: פסיכוזיס

**כרוניות (שימוש ממושך):**
- **דיכוי ציר HPA** (אדרנל)
- **תסמונת Cushing** (פנים ירח, עלייה במשקל, שעירות)
- **עיכוב גדילה** בילדים
- **אוסטאופורוזיס**
- **זיהומים מוגברים**
- **קטרקט, גלאוכומה**
- **שינויים פסיכיאטריים**
- **היפרטנסיה, סוכרת**
- **כיבי פפטי**

---

**⚠️ זהירות:**

🚨 **הפסקה פתאומית:** אסור בטיפול ממושך (>2 שבועות) ← אי-ספיקת אדרנל
🚨 **זיהומים:** עלול להסתיר סימנים ולהחמיר
🚨 **חיסונים חיים:** אסור בטיפול אימונוסופרסיבי
🚨 **סוכרת:** עלול להעלות סוכר משמעותית

---

**💡 פנינים קליניות:**

💎 **קרופ:** דקסמתזון מנת יחיד יעיל ל-48-72 שעות!

💎 **דלקת קרום המוח:** להתחיל דקסמתזון **לפני** האנטיביוטיקה הראשונה - מפחית נזק נוירולוגי

💎 **אסטמה:** מנה אחת דקסמתזון (0.6 mg/kg) = 5 ימים פרדניזולון

💎 **משך פעולה ארוך:** יתרון - קומפליאנס טובה. חיסרון - תופעות לוואי ממושכות

💎 **גמילה:** צריך רק אם טיפול >2 שבועות (דיכוי ציר HPA)""",
            "order_index": 0
        },
        {
            "title": "מתילפרדניזולון (סולומדרול) - Methylprednisolone (Solumedrol)",
            "section_type": "text",
            "content": """**Methylprednisolone (Solumedrol) - מתילפרדניזולון / סולומדרול**

**משפחה:** גלוקוקורטיקואיד (Glucocorticoid)

**תיאור:**
סטרואיד בעוצמה בינונית-גבוהה, משך פעולה בינוני

---

**📊 מינון:**

**אסטמה חריפה:**
💉 **1-2 mg/kg/dose** IV/PO כל **6 שעות**
- או **0.5-1 mg/kg** כל **6 שעות**
- מקסימום: **60-80 mg/day**

**Status Asthmaticus (חמור מאוד):**
💉 **מנת העמסה:** 2 mg/kg
💧 **תחזוקה:** 0.5-1 mg/kg כל 6 שעות

**פולס (Pulse Therapy) למחלות אוטואימוניות:**
💉 **10-30 mg/kg/dose** IV
- מקסימום: **1000 mg/dose**
- פעם ביום למשך **3 ימים**

**הלם ספטי (שנוי במחלוקת):**
💉 **1-2 mg/kg/dose**

**פגיעת חוט שדרה (במשך 23 שעות ראשונות):**
💉 **מנת העמסה:** 30 mg/kg במשך 15 דקות
💧 **עירוי:** 5.4 mg/kg/hour למשך 23-48 שעות
- ⚠️ שנוי במחלוקת! לא מומלץ יותר בגיידליינים חדשים

---

**🎯 התוויות:**

✅ **אסטמה חריפה / Status Asthmaticus**
✅ **אנפילקסיס / אלרגיה חמורה**
✅ **מחלות אוטואימוניות** (SLE, vasculitis, ITP)
✅ **דחיית השתלה**
✅ **בצקת מוחית**
✅ **COPD exacerbation**

---

**⏱️ פרמקולוגיה:**

**תחילת השפעה:**
- IV: **מהיר** (שעה)
- PO: **1-2 שעות**

**משך השפעה:**
- **12-36 שעות**

**זמן מחצית חיים:**
- **3-4 שעות** (ביולוגי: 18-36 שעות)

**עוצמה יחסית:**
- פי **5** מהידרוקורטיזון
- דומה לפרדניזולון

---

**⚠️ תופעות לוואי:**

דומות לכל הסטרואידים:

**חריפות:**
- היפרגליקמיה
- היפרטנסיה
- שינויים במצב רוח
- נדיר: פסיכוזיס סטרואידי

**כרוניות:**
- **דיכוי ציר HPA**
- תסמונת Cushing
- עיכוב גדילה
- אוסטאופורוזיס
- זיהומים מוגברים
- כיבי פפטי

---

**⚠️ זהירות:**

🚨 **Pulse therapy:** ניטור הדוק (BP, HR, glucose, electrolytes)
🚨 **הפסקה פתאומית:** אסור בטיפול ממושך
🚨 **זיהומים:** עלול להחמיר
🚨 **סוכרת:** בדיקת סוכר תכופה

---

**💡 פנינים קליניות:**

💎 **אסטמה חריפה:** סולומדרול IV אם לא יכול PO, אחרת פרדניזולון/דקסמתזון PO

💎 **Pulse therapy:** מינונים עצומים (10-30 mg/kg) למחלות אוטואימוניות חמורות

💎 **המרה PO:** Solumedrol 4 mg = Prednisone 5 mg

💎 **יתרון על הידרוקורטיזון:** פחות אפקט מינרלוקורטיקואיד (פחות retension נוזלים)

💎 **חוט שדרה:** פרוטוקול ישן, לא מומלץ יותר (ראיות חלשות, סיבוכים)""",
            "order_index": 1
        },
        {
            "title": "הידרוקורטיזון - Hydrocortisone",
            "section_type": "text",
            "content": """**Hydrocortisone - הידרוקורטיזון**

**משפחה:** גלוקוקורטיקואיד + מינרלוכורטיקואיד (Glucocorticoid + Mineralocorticoid)

**תיאור:**
הסטרואיד הפיזיולוגי הטבעי (קורטיזול), עוצמה נמוכה, משך קצר

---

**📊 מינון:**

**אי-ספיקת אדרנל חריפה (Adrenal Crisis):**
💉 **מנת הלם:** 50-100 mg/m² IV (או 1-2 mg/kg)
💧 **תחזוקה:** 50-100 mg/m²/day חלוקה לכל 6 שעות

**החלפה פיזיולוגית (Physiologic Replacement):**
💊 **8-15 mg/m²/day** חלוקה ל-3 מנות
- בוקר: 50%
- צהריים: 25%
- ערב: 25%

**Stress Dosing (כירורגיה, מחלה חמורה):**
💉 **2-5 פעמים** המינון הפיזיולוגי
- כירורגיה קלה: פי 2
- כירורגיה בינונית: פי 3
- כירורגיה גדולה/מחלה חמורה: פי 5

**הלם ספטי (שנוי במחלוקת):**
💉 **50 mg** כל **6 שעות**
- או 100 mg bolus ואחר כך 10 mg/hour

**אנפילקסיס:**
💉 **5-10 mg/kg** (מקסימום 500 mg)

---

**🎯 התוויות:**

✅ **אי-ספיקת אדרנל** (ראשונית או משנית) - **בחירה ראשונה!**
✅ **הלם ספטי עמיד** (במיוחד עם חשד לאי-ספיקת אדרנל)
✅ **אנפילקסיס**
✅ **מחלת אדיסון**
✅ **היפרפלזיה אדרנלית מולדת** (CAH)

---

**⏱️ פרמקולוגיה:**

**תחילת השפעה:**
- IV: **מיידית**
- PO: **1-2 שעות**

**משך השפעה:**
- **8-12 שעות**

**זמן מחצית חיים:**
- **1.5-2 שעות** (קצר!)

**עוצמה יחסית:**
- **בסיס ההשוואה** (×1)

---

**✅ יתרונות:**

✅ **השפעה מינרלוקורטיקואידית** (שומר Na⁺, מפריש K⁺) - חיוני באי-ספיקת אדרנל
✅ **הסטרואיד הפיזיולוגי** הטבעי
✅ **משך קצר** - שליטה טובה יותר

---

**⚠️ תופעות לוואי:**

**חריפות:**
- **אצירת נוזלים ונתרן** (השפעה מינרלוקורטיקואידית)
- **היפוקלמיה** (אשלגן נמוך)
- היפרגליקמיה
- היפרטנסיה

**כרוניות:**
דומות לסטרואידים אחרים (אך פחות בולטות בשל עוצמה נמוכה יחסית)

---

**⚠️ זהירות:**

🚨 **אצירת נוזלים:** ניטור נפחים, משקל, נתרן
🚨 **היפוקלמיה:** בדיקת אלקטרוליטים
🚨 **אי-ספיקת לב:** זהירות (retension נוזלים)

---

**💡 פנינים קליניות:**

💎 **אי-ספיקת אדרנל:** הידרוקורטיזון הבחירה היחידה! (יש אפקט מינרלוקורטיקואיד)

💎 **Stress Dosing:** חובה להעלות מינון במחלה/כירורגיה בחולים עם אי-ספיקת אדרנל

💎 **משך קצר:** צריך מתן תכוף (כל 6-8 שעות)

💎 **המרה:** Hydrocortisone 20 mg = Prednisone 5 mg = Dexamethasone 0.75 mg

💎 **הלם ספטי:** שקול רק אם יש חשד לאי-ספיקת אדרנל (hypotension refractory)

💎 **CAH:** טיפול כרוני באי-ספיקת אדרנל מולדת""",
            "order_index": 2
        },
        {
            "title": "פרדניזולון - Prednisolone",
            "section_type": "text",
            "content": """**Prednisolone - פרדניזולון**

**משפחה:** גלוקוקורטיקואיד (Glucocorticoid)

**תיאור:**
סטרואיד בעוצמה בינונית, משך פעולה בינוני, נפוץ מאוד בשימוש פומי

---

**📊 מינון:**

**אסטמה חריפה:**
💊 **1-2 mg/kg/day** PO (מנה אחת או חלוקה ל-2)
- מקסימום: **60 mg/day**
- משך: **3-5 ימים** (ילדים לא צריכים weaning!)

**קרופ:**
💊 **1-2 mg/kg/dose** (מנה אחת)
- חלופה לדקסמתזון

**נפרוטית תסמונת:**
💊 **60 mg/m²/day** (או 2 mg/kg/day, מקסימום 60 mg)
- משך: **4-6 שבועות**, אחר כך גמילה הדרגתית

**מחלות אוטואימוניות:**
💊 **0.5-2 mg/kg/day**
- תלוי במחלה וחומרה

**Anti-inflammatory:**
💊 **0.1-2 mg/kg/day** חלוקה ל-1-4 מנות

---

**🎯 התוויות:**

✅ **אסטמה חריפה** - **בחירה ראשונה PO!**
✅ **קרופ**
✅ **נפרוטית תסמונת**
✅ **IBD (Inflammatory Bowel Disease)**
✅ **מחלות אוטואימוניות**
✅ **אלרגיות**
✅ **ITP (Immune Thrombocytopenia)**

---

**⏱️ פרמקולוגיה:**

**תחילת השפעה:**
- PO: **1-2 שעות**

**משך השפעה:**
- **12-36 שעות**

**זמן מחצית חיים:**
- **2-4 שעות** (ביולוגי: 18-36 שעות)

**עוצמה יחסית:**
- פי **4-5** מהידרוקורטיזון
- דומה למתילפרדניזולון

---

**⚠️ תופעות לוואי:**

**חריפות (קורס קצר):**
- תיאבון מוגבר
- שינויים במצב רוח (היפראקטיביות, עצבנות)
- הפרעות שינה
- כאבי בטן
- היפרגליקמיה קלה

**כרוניות (שימוש ממושך):**
- **דיכוי ציר HPA**
- **עיכוב גדילה** (בילדים)
- תסמונת Cushing
- אוסטאופורוזיס
- זיהומים מוגברים
- קטרקט
- היפרטנסיה
- סוכרת

---

**⚠️ זהירות:**

🚨 **גמילה:** לא צריך weaning בקורס קצר (<14 ימים)
🚨 **שימוש ממושך (>2 שבועות):** גמילה הדרגתית חובה
🚨 **זיהומים:** עלול להחמיר
🚨 **חיסונים חיים:** אסור בטיפול כרוני

---

**💡 פנינים קליניות:**

💎 **אסטמה חריפה - מינון ומשך:**
- 1-2 mg/kg/day למשך **3-5 ימים**
- ילדים **לא צריכים weaning!** (פחות מ-14 ימים)

💎 **נפרוטית תסמונת:**
- פרדניזולון אבן היסוד בטיפול
- רמיסיה ב-~90% מהילדים
- עלול לחזור (steroid dependent)

💎 **Prednisolone vs Prednisone:**
- Prednisolone = המטבוליט הפעיל של Prednisone
- **מועדף בילדים** (אין צורך בהמרה בכבד)
- מועדף במחלות כבד

💎 **מתן בבוקר:** העדיפות - בוקר (מחקה קצב יממתי טבעי)

💎 **עם אוכל:** לקחת עם אוכל (הפחתת גירוי קיבה)

💎 **משך ארוך:** אם >2 שבועות - גמילה הדרגתית (10% מהמינון כל שבוע)""",
            "order_index": 3
        },
        {
            "title": "פרדניזון - Prednisone",
            "section_type": "text",
            "content": """**Prednisone - פרדניזון**

**משפחה:** גלוקוקורטיקואיד (Glucocorticoid)

**תיאור:**
פרו-דראג של פרדניזולון - דורש המרה בכבד לצורה הפעילה

---

**📊 מינון:**

**זהה לפרדניזולון:**
💊 **0.5-2 mg/kg/day** תלוי במצב

**אסטמה חריפה:**
💊 **1-2 mg/kg/day** למשך **3-5 ימים**

---

**🎯 התוויות:**

זהות לפרדניזולון

---

**⏱️ פרמקולוגיה:**

זהה לפרדניזולון (לאחר המרה בכבד)

---

**💡 Prednisolone vs Prednisone:**

**Prednisone:**
- פרו-דראג (לא פעיל)
- דורש המרה בכבד ל-Prednisolone
- **פחות מועדף בילדים**
- **אסור במחלות כבד חמורות** (אין המרה!)

**Prednisolone:**
- פעיל ישירות
- לא דורש המרה בכבד
- **מועדף בילדים**
- **בחירה במחלות כבד**

💎 **המלצה:** בילדים - תמיד העדיפות ל-**Prednisolone**!

---

**⚠️ זהירות:**

🚨 **מחלות כבד:** Prednisone לא יעיל! (צריך המרה לצורה פעילה)
🚨 **העדיפות בילדים:** Prednisolone > Prednisone

---

**💡 פנינה קלינית:**

💎 בפועל ברוב המקומות משתמשים ב-Prednisolone בילדים ולא ב-Prednisone (אין המרה בכבד, יעיל יותר)""",
            "order_index": 4
        },
        {
            "title": "נקודות מפתח - סטרואידים",
            "section_type": "text",
            "content": """**🎯 נקודות מפתח:**

✅ **דקסמתזון קרופ:** 0.6 mg/kg PO/IM/IV (מקס 10 mg). מנה אחת יעילה ל-48-72 שעות!

✅ **דקסמתזון אסטמה:** 0.6 mg/kg (מקס 16 mg). מנה אחת = 5 ימים פרדניזולון

✅ **דקסמתזון מנינגיטיס:** 0.15 mg/kg כל 6 שעות × 2-4 ימים. לפני/עם אנטיביוטיקה!

✅ **סולומדרול אסטמה:** 1-2 mg/kg כל 6 שעות. חמור - 2 mg/kg loading

✅ **הידרוקורטיזון אי-ספיקת אדרנל:** 50-100 mg/m² IV (קריזיס). 8-15 mg/m²/day (replacement)

✅ **פרדניזולון אסטמה:** 1-2 mg/kg/day × 3-5 ימים. לא צריך weaning!

✅ **עוצמה יחסית:** Dex (25-30×) > Solumedrol/Pred (4-5×) > Hydrocortisone (1×)

✅ **משך פעולה:** Dex (36-72h) > Pred/Solu (12-36h) > Hydro (8-12h)""",
            "order_index": 5
        },
        {
            "title": "אזהרות קריטיות",
            "section_type": "text",
            "content": """**🚨 אזהרות חשובות:**

🔴 **הפסקה פתאומית:** אסור בטיפול >2 שבועות! סכנת אי-ספיקת אדרנל חריפה (קריזיס)

🔴 **דיכוי ציר HPA:** בטיפול ממושך - גמילה הדרגתית חובה (10% כל שבוע)

🔴 **Stress Dosing:** חולים על סטרואידים כרוניים - העלה מינון פי 2-5 במחלה/כירורגיה

🔴 **חיסונים חיים:** אסורים בטיפול כרוני (>2 שבועות, >2 mg/kg/day prednisone)

🔴 **זיהומים:** סטרואידים מסתירים סימנים ומחמירים זיהומים

🔴 **עיכוב גדילה בילדים:** בטיפול כרוני - ניטור גדילה חובה

🔴 **פסיכוזיס סטרואידי:** אפשרי גם במנות בודדות! שינויי התנהגות, הזיות

🔴 **אוסטאופורוזיס:** בטיפול ממושך - תוספת סידן וויטמין D""",
            "order_index": 6
        },
        {
            "title": "פנינים קליניות",
            "section_type": "text",
            "content": """**💎 פנינים קליניות:**

💎 **קרופ - דקסמתזון מנת יחיד:** 0.6 mg/kg יעיל ל-48-72 שעות! מונע אשפוז

💎 **דקסמתזון vs פרדניזולון באסטמה:** מנת יחיד דקסמתזון (0.6 mg/kg) = 5 ימים פרדניזולון (קומפליאנס!)

💎 **מנינגיטיס - Timing חשוב:** דקסמתזון לפני או עם האנטיביוטיקה הראשונה. מאוחר מדי = לא יעיל

💎 **ילדים לא צריכים weaning:** קורס קצר (<14 ימים) - להפסיק בבת אחת. ציר HPA מתאושש מהר

💎 **Prednisolone > Prednisone:** בילדים תמיד העדיפות לפרדניזולון (לא צריך המרה בכבד)

💎 **אי-ספיקת אדרנל - רק הידרוקורטיזון:** שאר הסטרואידים אין להם אפקט מינרלוקורטיקואיד

💎 **Stress Dosing Calculator:** מינון יומי × 2 (כירורגיה קלה), × 3 (בינונית), × 5 (גדולה/חמורה)

💎 **הידרוקורטיזון תדירות:** משך קצר ← צריך כל 6-8 שעות (דקסמתזון פעם ביום)

💎 **Pulse Therapy:** מינונים עצומים (10-30 mg/kg solumedrol) למחלות אוטואימוניות חמורות

💎 **תזמון מתן:** בוקר מועדף (מחקה קצב יממתי). ערב ← הפרעות שינה

💎 **עם אוכל:** כל הסטרואידים PO - לקחת עם אוכל (הפחתת גירוי קיבה)

💎 **המרה בין סטרואידים:**
- Hydrocortisone 20 mg = Prednisone 5 mg = Methylpred 4 mg = Dex 0.75 mg

💎 **ניטור בטיפול כרוני:** גדילה, BP, glucose, עצמות (DEXA), עיניים (קטרקט/גלאוקומה)""",
            "order_index": 7
        }
    ]
    
    # הוספת כל המקטעים
    print(f"\n📚 מוסיף {len(sections)} מקטעים...")
    
    for idx, section_data in enumerate(sections, 1):
        section_data['topic_id'] = topic_id
        
        section = create_content_section(section_data)
        
        if section:
            print(f"   ✅ מקטע {idx}/{len(sections)}: {section_data['title']}")
        else:
            print(f"   ❌ שגיאה במקטע {idx}: {section_data['title']}")
            return False
    
    return True

if __name__ == "__main__":
    print("="*60)
    print("💊 הוספת תוכן: סטרואידים")
    print("="*60)
    
    try:
        success = add_steroids()
        
        if success:
            print("\n🎉 הושלם בהצלחה!")
            print("\n💡 התוכן כולל:")
            print("   - דקסמתזון (Dexamethasone)")
            print("   - סולומדרול (Methylprednisolone)")
            print("   - הידרוקורטיזון (Hydrocortisone)")
            print("   - פרדניזולון (Prednisolone)")
            print("   - פרדניזון (Prednisone)")
        else:
            print("\n❌ הייתה בעיה בהוספת התוכן")
    
    except Exception as e:
        print(f"\n❌ שגיאה: {e}")
        import traceback
        traceback.print_exc()
