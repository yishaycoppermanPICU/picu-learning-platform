#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
הוספת תוכן: אינהלציות (Inhalations)
"""

from utils.database import init_supabase, create_content_item, create_content_section

def add_inhalations():
    """הוספת תרופות אינהלציות"""
    
    print("🔄 מתחבר למסד הנתונים...")
    supabase = init_supabase()
    
    if not supabase:
        print("❌ שגיאה בחיבור למסד נתונים")
        return False
    
    print("✅ חיבור הצליח!")
    
    # יצירת הנושא הראשי
    print("\n📝 יוצר נושא: אינהלציות...")
    
    topic_data = {
        "title": "אינהלציות - Inhalations",
        "category": "medications",
        "description": "מדריך מקיף לתרופות אינהלציות: ונטולין, בודזוניד, אטרובנט, אפינפרין רצמי",
        "icon": "💨",
        "slug": "inhalations",
        "tags": ["תרופות", "אינהלציות", "ונטולין", "בודזוניד", "אטרובנט", "אפינפרין", "ברונכוספאזם", "אסטמה"],
        "order_index": 7
    }
    
    topic = create_content_item(topic_data)
    
    if not topic:
        print("❌ שגיאה ביצירת הנושא")
        return False
    
    topic_id = topic['id']
    print(f"✅ נושא נוצר בהצלחה! ID: {topic_id}")
    
    # הוספת מקטעים
    sections = [
        {
            "title": "ונטולין (סלבוטמול) - Ventolin (Salbutamol)",
            "section_type": "text",
            "content": """**Salbutamol (Ventolin) - סלבוטמול / ונטולין**

**משפחה:** Beta-2 Agonist (אגוניסט בטא-2 סלקטיבי)

**מנגנון:**
גירוי קולטני Beta-2 ← הרחבת דרכי נשימה (ברונכודילטציה)

---

**📊 מינון:**

**נבולייזר (Nebulizer):**
💨 **0.15 mg/kg/dose** (מינימום 2.5 mg)
- **מתחת לגיל 5:** 2.5 mg
- **מעל גיל 5:** 5 mg
- תדירות: כל **20 דקות** במצב חירום, אחר כך כל **4-6 שעות**

**עירוי מתמשך (Continuous Nebulization):**
💧 **0.5 mg/kg/hour** (מקסימום 15-20 mg/hour)
- לאסטמה חמורה, Status Asthmaticus

**Inhaler (MDI - Metered Dose Inhaler):**
💨 **2-4 puffs** כל **4-6 שעות**
- עם spacer תמיד בילדים

**IV (במצבים חריגים):**
💉 **Loading:** 15 mcg/kg במשך 10 דקות
💧 **Continuous:** 0.1-0.2 mcg/kg/minute (עד 1-2 mcg/kg/min)

---

**🎯 התוויות:**

✅ **ברונכוספאזם** (אסטמה, ברונכיוליטיס)
✅ **אסטמה חריפה** - בחירה ראשונה!
✅ **COPD exacerbation**
✅ **היפרקלמיה** (אשלגן גבוה - מעביר אשלגן לתוך התא)

---

**⏱️ פרמקולוגיה:**

**תחילת השפעה:**
- נבולייזר: **5-15 דקות**
- Inhaler: **5 דקות**

**שיא השפעה:**
- **30-90 דקות**

**משך השפעה:**
- **4-6 שעות**

---

**⚠️ תופעות לוואי:**

**קרדיווסקולריות:**
- **טכיקרדיה** (עליית דופק) - שכיח מאוד!
- טכיאריתמיות
- פלפיטציות

**מטבוליות:**
- **היפוקלמיה** (אשלגן נמוך) - במינונים גבוהים
- היפרגליקמיה (סוכר גבוה)
- חמצת לקטית

**CNS:**
- **רעד** (tremor) - שכיח!
- עצבנות, חרדה
- כאב ראש
- סחרחורת

**נשימתיות:**
- גירוי דרכי נשימה
- ברונכוספאזם פרדוקסלי (נדיר)

---

**⚠️ זהירות:**

🚨 **טכיקרדיה:** ניטור קרדיאקי במצבים חמורים
🚨 **היפוקלמיה:** בדיקת אשלגן במינונים גבוהים או עירוי ממושך
🚨 **מחלות לב:** זהירות במחלת לב קיימת
🚨 **סוכרת:** עלול להעלות סוכר

---

**💡 פנינים קליניות:**

💎 **אסטמה חריפה - Protocol:**
- Salbutamol כל 20 דקות × 3
- אם לא משתפר ← עירוי מתמשך
- תמיד עם **Ipratropium** (אטרובנט) בשעה הראשונה

💎 **עירוי מתמשך:** יעיל יותר ופחות טכיקרדיה מבולוסים תכופים

💎 **היפרקלמיה:** 10-20 mg נבולייזר - מעביר אשלגן לתוך התא תוך 30 דקות

💎 **Spacer בילדים:** חובה! מגביר משמעותית את ההגעה לריאות

💎 **לויקוציטוזיס:** סלבוטמול עלול לגרום לעליית לויקוציטים (דמוביליזציה)""",
            "order_index": 0
        },
        {
            "title": "אטרובנט (איפרטרופיום) - Atrovent (Ipratropium)",
            "section_type": "text",
            "content": """**Ipratropium Bromide (Atrovent) - איפרטרופיום / אטרובנט**

**משפחה:** Anticholinergic (אנטי-כולינרגי)

**מנגנון:**
חוסם קולטנים מוסקריניים (M3) ← הרחבת דרכי נשימה + הפחתת הפרשות

---

**📊 מינון:**

**נבולייזר:**
💨 **250 mcg/dose** (אמפולה אחת)
- תדירות: כל **20 דקות** במצב חירום (עד 3 מנות), אחר כך כל **4-6 שעות**

**ילדים קטנים (מתחת לגיל 5):**
💨 **125-250 mcg/dose**

**Inhaler (MDI):**
💨 **2-3 puffs** (20 mcg/puff)
- תדירות: כל **4-6 שעות**

---

**🎯 התוויות:**

✅ **אסטמה חריפה** - **בשילוב עם Salbutamol!**
✅ **ברונכוספאזם**
✅ **COPD exacerbation**
✅ **ברונכיוליטיס**

---

**⏱️ פרמקולוגיה:**

**תחילת השפעה:**
- **15 דקות**

**שיא השפעה:**
- **1-2 שעות**

**משך השפעה:**
- **4-6 שעות**

---

**✅ יתרונות:**

✅ **אין השפעה על דופק** (להבדיל מסלבוטמול)
✅ **אין השפעה על אשלגן**
✅ **סינרגיה עם Salbutamol** - אפקט מוגבר משמעותית!

---

**⚠️ תופעות לוואי:**

**מקומיות:**
- **יובש בפה** (dry mouth)
- טעם מר
- גירוי גרון

**נשימתיות:**
- שיעול
- ברונכוספאזם פרדוקסלי (נדיר)

**CNS:**
- כאב ראש
- סחרחורת
- עצבנות (קל)

**אחרות:**
- טשטוש ראייה (אם מגיע לעיניים)
- אצירת שתן (נדיר)

---

**⚠️ זהירות:**

🚨 **גלאוקומה:** זהירות - לא לתת באינהלציה עם מסכה (עלול להגיע לעיניים)
🚨 **Benign Prostatic Hyperplasia:** עלול להחמיר אצירת שתן
🚨 **אלרגיה לבוטנים/סויה:** חלק מהתכשירים מכילים לציטין

---

**💡 פנינים קליניות:**

💎 **אסטמה חריפה - Golden Rule:**
**תמיד לשלב Ipratropium עם Salbutamol בשעה הראשונה!**
- הוכח שמשפר תוצאות
- מפחית צורך באשפוז
- יעיל יותר מכל אחד לבד

💎 **אטרובנט לא מעלה דופק:** יתרון במטופלים טכיקרדיים

💎 **משך השפעה:** ארוך יותר מסלבוטמול (6 שעות vs 4 שעות)

💎 **ברונכיוליטיס:** אפקט צנוע - אבל מסייע בשילוב עם סלבוטמול

💎 **יובש בפה:** תופעת לוואי שכיחה אך לא מטרידה בדרך כלל

💎 **לא נספג מערכתית:** ספיגה מינימלית ← פחות תופעות לוואי סיסטמיות""",
            "order_index": 1
        },
        {
            "title": "בודזוניד (פולמיקורט) - Budesonide (Pulmicort)",
            "section_type": "text",
            "content": """**Budesonide (Pulmicort) - בודזוניד / פולמיקורט**

**משפחה:** Inhaled Corticosteroid (סטרואיד אינהלציוני)

**מנגנון:**
אנטי-דלקתי חזק ← מפחית בצקת דרכי נשימה, הפרשות ותגובה אלרגית

---

**📊 מינון:**

**נבולייזר (Nebulizer):**

**קרופ (Croup):**
💨 **2 mg/dose** (מנה אחת)
- יעיל מאוד! טוב כמו דקסמתזון

**אסטמה כרונית - תחזוקה:**
💨 **0.25-1 mg** פעם-פעמיים ביום
- **תינוקות וילדים קטנים (6 חודשים-6 שנים):**
  - מינון נמוך: **0.25-0.5 mg/day**
  - מינון בינוני: **0.5-1 mg/day**
  - מינון גבוה: **1 mg פעמיים ביום**

**ילדים מעל גיל 6:**
- מינון נמוך: **0.5 mg/day**
- מינון בינוני: **1 mg/day**
- מינון גבוה: **2 mg/day**

**Inhaler (Turbuhaler/MDI):**
💨 **100-400 mcg פעמיים ביום**

---

**🎯 התוויות:**

✅ **קרופ (Croup)** - **יעיל כמו דקסמתזון!**
✅ **אסטמה כרונית** (תחזוקה, לא חירום)
✅ **ברונכיוליטיס חוזרת**
✅ **Chronic Lung Disease** (BPD בפגים)

❌ **לא לשימוש באסטמה חריפה!** (צריך סטרואיד סיסטמי)

---

**⏱️ פרמקולוגיה:**

**תחילת השפעה:**
- **24-48 שעות** (לא מיידי!)

**אפקט מקסימלי:**
- **1-2 שבועות** טיפול קבוע

**משך השפעה:**
- ממושך (לאחר טיפול סדיר)

---

**✅ יתרונות:**

✅ **ספיגה סיסטמית נמוכה מאוד**
✅ **מעט תופעות לוואי סיסטמיות** (להבדיל מסטרואידים פומיים)
✅ **יעיל לטיפול ארוך טווח**
✅ **קרופ:** מונע צורך בהרדמה/אינטובציה

---

**⚠️ תופעות לוואי:**

**מקומיות (שכיחות):**
- **קנדידיאזיס של הפה** (Oral Thrush)
  - מניעה: שטיפת פה אחרי שימוש
- צרידות
- שיעול
- גירוי גרון

**סיסטמיות (נדירות, בשימוש ממושך במינונים גבוהים):**
- **עיכוב גדילה** (מינימלי)
- דיכוי ציר HPA (אדרנל)
- קטרקט
- גלאוקומה
- אוסטאופורוזיס (בטווח ארוך מאוד)

---

**⚠️ זהירות:**

🚨 **זיהום פעיל:** לא להתחיל בזיהום פעיל (TB, פטריות)
🚨 **שטיפת פה:** חובה אחרי כל שימוש (מניעת thrush)
🚨 **מעבר מסטרואיד פומי:** גמילה הדרגתית (סכנת אי-ספיקת אדרנל)

---

**⚠️ התוויות נגד:**

❌ **זיהום פטרייתי פעיל** (Candida, Aspergillus)
❌ **TB ריאתי לא מטופל**
❌ **אסטמה חריפה** (צריך סיסטמי!)

---

**💡 פנינים קליניות:**

💎 **קרופ - מהפכה:** בודזוניד נבולייזר יעיל כמו דקסמתזון IM/PO!
- מינון: **2 mg** פעם אחת
- תחילת השפעה: תוך שעה
- מונע צורך באשפוז ואינטובציה

💎 **אסטמה כרונית:** טיפול תחזוקה בלבד. **לא לאסטמה חריפה!**

💎 **Spacer + שטיפת פה:** הכרחי להפחתת thrush ותופעות סיסטמיות

💎 **עיכוב גדילה:** מינימלי בילדים (בודזוניד אחד הבטוחים)

💎 **שילוב עם LABA:** בודזוניד + Formoterol (Symbicort) - לאסטמה בינונית-חמורה

💎 **BPD בפגים:** בודזוניד נבולייזר יעיל בפגים עם Bronchopulmonary Dysplasia

💎 **לא מיידי:** צריך 24-48 שעות לאפקט. לא משתמשים כטיפול הצלה!""",
            "order_index": 2
        },
        {
            "title": "אפינפרין רצמי - Racemic Epinephrine",
            "section_type": "text",
            "content": """**Racemic Epinephrine (Adrenaline) - אפינפרין רצמי**

**תיאור:**
תערובת של L-epinephrine ו-D-epinephrine ← אפקט ברונכודילטור + הפחתת בצקת

**מנגנון:**
- **Alpha:** כיווץ כלי דם ← הפחתת בצקת דרכי נשימה
- **Beta-2:** הרחבת דרכי נשימה

---

**📊 מינון:**

**נבולייזר:**
💨 **0.5 ml/kg** של תמיסה **1:1000** (2.25% racemic epinephrine)
- **מינימום:** 0.25 ml
- **מקסימום:** 5 ml
- תדירות: כל **1-2 שעות** במצב חירום

**ריכוז אפינפרין:**
💨 **400 mcg/kg/dose**

**חלופה - L-epinephrine רגיל:**
💨 **5 ml** של 1:1000
- פחות זמין אבל יעיל לא פחות

---

**🎯 התוויות:**

✅ **קרופ (Croup)** - **בחירה ראשונה במצבים בינוניים-חמורים!**
✅ **סטרידור פוסט-אקסטובציה**
✅ **אדמה תת-גלוטית**
✅ **אנגיואדמה של דרכי נשימה**

---

**⏱️ פרמקולוגיה:**

**תחילת השפעה:**
- **5-10 דקות**

**שיא השפעה:**
- **30 דקות**

**משך השפעה:**
- **1-3 שעות**

⚠️ **"Rebound Effect":** תסמינים עלולים לחזור אחרי 2-4 שעות!

---

**⚠️ תופעות לוואי:**

**קרדיווסקולריות:**
- **טכיקרדיה** (עליית דופק) - שכיח
- פלפיטציות
- היפרטנסיה (עליית לחץ דם)
- אריתמיות (נדיר)

**CNS:**
- עצבנות, חרדה
- רעד
- כאב ראש

**אחרות:**
- חיוורון
- הזעה
- בחילות

---

**⚠️ זהירות:**

🚨 **Rebound Phenomenon:** תסמינים חוזרים אחרי 2-4 שעות!
- **חובה ניטור 4-6 שעות** לאחר מתן
- אם משתפר בהתחלה ואז מחמיר ← צריך אשפוז

🚨 **טכיקרדיה:** ניטור קרדיאקי
🚨 **מחלות לב:** זהירות במחלת לב קיימת

---

**⚠️ התוויות נגד:**

❌ **אפיגלוטיטיס** (Epiglottitis) - עלול לגרום לחסימה מוחלטת!

---

**💡 פנינים קליניות:**

💎 **קרופ - Protocol:**
1. **קל:** דקסמתזון PO
2. **בינוני-חמור:** דקסמתזון + **אפינפרין רצמי**
3. **חמור:** דקסמתזון + אפינפרין רצמי + NIV/HFNC

💎 **Rebound Effect - חשוב!**
- תמיד לתת **דקסמתזון** (סטרואיד) יחד עם אפינפרין
- דקסמתזון מונע/מפחית rebound
- ניטור 4-6 שעות חובה

💎 **סטרידור פוסט-אקסטובציה:**
- אפינפרין רצמי יעיל מאוד
- אם לא משתפר ← שקול ריאינטובציה

💎 **L-epinephrine vs Racemic:**
- L-epinephrine (1:1000) **יעיל לא פחות**
- יותר זמין
- מינון: 5 ml של 1:1000 = כמו racemic

💎 **קרופ חמור:** אפינפרין + דקסמתזון + בודזוניד (טריפל תרפיה)

💎 **מסכה vs Mouthpiece:** במסכה - אפקט על אף וסינוסים. Mouthpiece יעיל יותר לדרכי נשימה תחתונות

💎 **אנגיואדמה:** אפינפרין רצמי עוזר זמנית עד לטיפול הסיבתי (אנטיהיסטמינים, סטרואידים)""",
            "order_index": 3
        },
        {
            "title": "נקודות מפתח - אינהלציות",
            "section_type": "text",
            "content": """**🎯 נקודות מפתח:**

✅ **ונטולין (Salbutamol):** 0.15 mg/kg (מינימום 2.5 mg, מקסימום 5 mg). כל 20 דקות במצב חירום

✅ **אטרובנט (Ipratropium):** 250 mcg (אמפולה אחת). **תמיד לשלב עם ונטולין בשעה ראשונה!**

✅ **בודזוניד קרופ:** 2 mg פעם אחת. יעיל כמו דקסמתזון IM!

✅ **בודזוניד אסטמה:** 0.25-1 mg פעם-פעמיים ביום. תחזוקה בלבד, לא חירום!

✅ **אפינפרין רצמי:** 0.5 ml/kg (מקס 5 ml) של 1:1000. חובה דקסמתזון יחד! Rebound אחרי 2-4 שעות

✅ **עירוי ונטולין מתמשך:** 0.5 mg/kg/hour. יעיל יותר מבולוסים באסטמה חמורה

✅ **Spacer בילדים:** חובה עם MDI. מגביר פי כמה את ההגעה לריאות""",
            "order_index": 4
        },
        {
            "title": "אזהרות קריטיות",
            "section_type": "text",
            "content": """**🚨 אזהרות חשובות:**

🔴 **אפינפרין רצמי Rebound:** תסמינים חוזרים אחרי 2-4 שעות! חובה ניטור 4-6 שעות

🔴 **אפינפרין רצמי + דקסמתזון:** תמיד ביחד! דקסמתזון מונע rebound

🔴 **אפינפרין באפיגלוטיטיס:** אסור! עלול לגרום לחסימה מוחלטת

🔴 **ונטולין טכיקרדיה:** שכיח מאוד. ניטור קרדיאקי במינונים גבוהים

🔴 **ונטולין היפוקלמיה:** במינונים גבוהים או עירוי ממושך - בדוק אשלגן!

🔴 **בודזוניד Oral Thrush:** שכיח! חובה שטיפת פה אחרי כל שימוש

🔴 **בודזוניד לא לחירום:** אפקט רק אחרי 24-48 שעות. לא לאסטמה חריפה!

🔴 **אטרובנט גלאוקומה:** זהירות - לא עם מסכה קרוב לעיניים""",
            "order_index": 5
        },
        {
            "title": "פנינים קליניות",
            "section_type": "text",
            "content": """**💎 פנינים קליניות:**

💎 **אסטמה חריפה Golden Protocol:**
- Salbutamol + Ipratropium ביחד כל 20 דקות × 3
- Ipratropium רק בשעה ראשונה
- אם לא משתפר ← עירוי salbutamol מתמשך

💎 **קרופ Protocol:**
- קל: דקסמתזון PO/IM
- בינוני-חמור: דקסמתזון + אפינפרין רצמי (+ בודזוניד לפי חומרה)
- חובה ניטור 4-6 שעות (rebound!)

💎 **Ipratropium + Salbutamol סינרגיה:** יעיל פי 2 מכל אחד לבד!

💎 **עירוי ונטולין מתמשך:** פחות טכיקרדיה, יותר יעיל מבולוסים תכופים

💎 **בודזוניד בקרופ:** יעיל כמו דקסמתזון! אלטרנטיבה מצוינת

💎 **ונטולין להיפרקלמיה:** 10-20 mg נבולייזר מעביר אשלגן לתוך התא

💎 **L-epinephrine = Racemic:** יעיל לא פחות, יותר זמין

💎 **Spacer vs נבולייזר:** במצב יציב - spacer יעיל לא פחות ויותר נוח

💎 **ברונכוספאזם פרדוקסלי:** נדיר אבל אפשרי. אם מחמיר - להפסיק!

💎 **בודזוניד BPD בפגים:** יעיל בפגים עם Bronchopulmonary Dysplasia

💎 **אטרובנט משך ארוך:** 6 שעות (ונטולין 4 שעות)

💎 **Oral Thrush מניעה:** spacer + שטיפת פה/אכילה-שתייה אחרי בודזוניד""",
            "order_index": 6
        }
    ]
    
    # הוספת כל המקטעים
    print(f"\n📚 מוסיף {len(sections)} מקטעים...")
    
    for idx, section_data in enumerate(sections, 1):
        section_data['topic_id'] = topic_id
        
        section = create_content_section(section_data)
        
        if section:
            print(f"   ✅ מקטע {idx}/{len(sections)}: {section_data['title']}")
        else:
            print(f"   ❌ שגיאה במקטע {idx}: {section_data['title']}")
            return False
    
    return True

if __name__ == "__main__":
    print("="*60)
    print("💨 הוספת תוכן: אינהלציות")
    print("="*60)
    
    try:
        success = add_inhalations()
        
        if success:
            print("\n🎉 הושלם בהצלחה!")
            print("\n💡 התוכן כולל:")
            print("   - ונטולין (Salbutamol)")
            print("   - אטרובנט (Ipratropium)")
            print("   - בודזוניד (Budesonide)")
            print("   - אפינפרין רצמי")
        else:
            print("\n❌ הייתה בעיה בהוספת התוכן")
    
    except Exception as e:
        print(f"\n❌ שגיאה: {e}")
        import traceback
        traceback.print_exc()
