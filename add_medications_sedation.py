#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
הוספת תוכן: תרופות סדציה והרדמה (Sedation & Anesthesia)
"""

from utils.database import init_supabase, create_content_item, create_content_section

def add_sedation_medications():
    """הוספת תרופות סדציה והרדמה"""
    
    print("🔄 מתחבר למסד הנתונים...")
    supabase = init_supabase()
    
    if not supabase:
        print("❌ שגיאה בחיבור למסד נתונים")
        return False
    
    print("✅ חיבור הצליח!")
    
    # יצירת הנושא הראשי
    print("\n📝 יוצר נושא: סדציה והרדמה...")
    
    topic_data = {
        "title": "סדציה והרדמה - Sedation & Anesthesia",
        "category": "medications",
        "description": "מדריך מקיף לתרופות סדציה והרדמה: מידזולם, קטמין, מורפין, פנטניל, רקורוניום ועוד",
        "icon": "💉",
        "slug": "sedation_anesthesia",
        "tags": ["תרופות", "סדציה", "הרדמה", "מידזולם", "קטמין", "מורפין", "פנטניל", "רקורוניום", "אופיאטים"],
        "order_index": 2
    }
    
    topic = create_content_item(topic_data)
    
    if not topic:
        print("❌ שגיאה ביצירת הנושא")
        return False
    
    topic_id = topic['id']
    print(f"✅ נושא נוצר בהצלחה! ID: {topic_id}")
    
    # הוספת מקטעים
    sections = [
        {
            "title": "מידזולם (דורמיקום) - Midazolam",
            "section_type": "text",
            "content": """**Midazolam (Dormicum) - מידזולם**

**משפחה:** בנזודיאזפינים

**התוויות:**
- הרדמה לפני פרוצדורות (אינטובציה, הכנסת נקז)
- סדציה מתמשכת למטופלים מונשמים
- פרכוסים

---

**📊 מינון להרדמה לפני פרוצדורות:**

**ילדים:**
💉 **0.05-0.1 mg/kg**

**מינון מקסימלי:**
- מתחת לגיל 6: **6 mg** (כולל)
- מעל גיל 6: **10 mg** (כולל)

**מתבגרים:**
- מנה התחלתית: **1 mg**
- להעלות מינון **בהדרגתיות**
- מקסימום: **10 mg** (כולל)

⚠️ **זהירות מיוחדת:**
ילדים **מתחת לגיל חצי שנה** ← נטייה רבה יותר ל:
- דיכוי נשימתי
- חסימת נתיב אוויר

---

**👃 מידזולם נזאלי:**
יש לתת דרך **מזרק ייעודי** למתן נזאלי

**מינון:**
💧 **0.2 mg/kg** במנה אחת
- ניתן לחזור על המינון לאחר **15 דקות**
- מינון מוגבר: דווח גם על מינונים עד **0.8 mg/kg**
- מקסימום: **10 mg**

---

**💊 מינון פומי:**
**0.3 mg/kg**

---

**💧 סדציה מתמשכת (מטופלים מונשמים):**

**מתן מתמשך:**
💧 **0.8-2 mcg/kg/minute**
- מינון מקסימלי: **10 mg/hour**

---

**⚡ פרכוסים:**

**פומי:** 0.3 mg/kg

**נזאלי:** 0.2 mg/kg/dose (פעם אחת, מקסימום 10 mg)

---

**🔄 גמילה ממידזולם:**
⚠️ בקרוב יצא פרוטוקול כיצד להימנע מ**תסמונת גמילה** כתוצאה משימוש ממושך במידזולם

---

**תופעות לוואי:**
- ירידת לחץ דם
- דיכוי לבבי (ברדיקרדיה, ירידת נפח פעימה)
- הקאות
- **דיכוי נשימתי (אפנאה)**
- דיפלופיה (ראייה כפולה)""",
            "order_index": 0
        },
        {
            "title": "קטמין - Ketamine",
            "section_type": "text",
            "content": """**Ketamine - קטמין**

**משפחה:** פנציקלידין

**מנגנון:**
חוסמת קולטנים במוח ← גורמת לניתוק המוח מהגוף **אך ללא איבוד מלא של ההכרה**

**יתרונות:**
✅ לא מדכא את הנשימה
✅ לא מדכא את רפלקס הבליעה
✅ **לא מוריד לחץ דם**
✅ **לא משפיע על ICP** (שובר מיתוס ישן!)

**התוויות:**
- טשטוש
- שיכוך כאב
- הרדמה
- אינטובציה
- סדציה לפני פרוצדורות
- סדציה בחולים במצב קריטי

---

**📊 מינון דף החייאה:**
💉 **1 mg/kg**

⚠️ **הערה חשובה:**
לוודא שריכוז האמפולה הוא **50 mg/50 ml** (כשמסתכלים בדף החייאה המ"ל נגזר מריכוז הבקבוקון)

---

**💧 סדציה בחולים קריטיים:**

**מינון:**
💉 **0.5-2 mg/kg** (בולוס)
ואחר כך ← **5-20 mcg/kg/minute** (עירוי מתמשך)

**במקרים חריגים:**
ניתן להעלות עד **60 mcg/kg/minute**

---

**👃 מתן נזאלי (נדיר במחלקה):**
- מינון: **0.5-1.5 mg/kg/dose**
- מחלקים לשניים ונותנים אחד בכל נחיר
- פעם אחת
- מקסימום: **100 mg**

---

**💊 מתן אוראלי (בילדים מתחת לגיל 8):**
- מינון: **5 mg/kg/dose**
- **30-45 דקות** לפני הפרוצדורה
- **יעיל בפציעות (לצרציות) ובכוויות**

---

**⏱️ פרמקוקינטיקה:**
- תחילת השפעה: **2-5 דקות**
- משך השפעה: **10-20 דקות**

---

**תופעות לוואי:**
- **סיוטים והזיות**
- לרינגוספאזם
- פריחה
- **ריור מוגבר** (לכן נותנים אטרופין באינטובציה)""",
            "order_index": 1
        },
        {
            "title": "מורפין - Morphine",
            "section_type": "text",
            "content": """**Morphine - מורפין**

**תיאור:**
**אב טיפוס של אופיאטים** - לשיכוך כאב ברמה גבוהה

**מינון כללי:**
💉 **0.1 mg/kg**

**מינון בילודים וילדים:**
💉 **0.05-0.2 mg/kg**

---

**תופעות לוואי:**

**נשימתיות:**
- **דיכוי נשימתי**

**קרדיווסקולריות:**
- היפוטנסיביות
- ברדיקרדיות

**גסטרואינטסטינאליות:**
- **בחילות** (בעיקר בתחילת הטיפול)
  - העדיפות: **קיטריל**
  - לפרמין יש תופעת לוואי של דיסטוניה
- **עצירות עד לחסימת מעיים** ← ניתן מרככי צואה

**נוירולוגיות:**
- שינה ונמנום
- סבילות לתרופה
- **התמכרות**

**אורולוגיות:**
- אצירת שתן

---

**🚨 הרעלת מורפין:**

**סימנים:**
- עור קר ולח
- **אישונים צרים**
- דיכוי נשימתי
- ירידת לחץ דם
- עד קומה עמוקה

**טיפול:**
💉 **Naloxone (נלוקסון)**

---

**⚠️ זהירות בפגיעת ראש:**

דיכוי נשימתי ← אגירת CO₂ ← הרחבת כלי דם במוח ← **עליית ICP**

לכן **זהירות** במטופלים עם טראומת ראש!""",
            "order_index": 2
        },
        {
            "title": "פנטניל - Fentanyl",
            "section_type": "text",
            "content": """**Fentanyl - פנטניל**

**תיאור:**
**אופיאט, נרקוטיקה**

**יתרונות:**
- זמן השפעה **קצר** (חצי שעה) IV
- מתאים לטיפול בכאב לפעולות קצרות
- מתאים למתן ממושך בעירוי
- **מתאים לחולים במצב של הלם/הלם היפוולמי/מחלות לב**

**צורות מתן:**
- IV (רגיל וממושך)
- מדבקות **דורג'סיק**
- סוכריה

---

**📊 מינון:**

**תינוקות:**
💉 **1-2 mcg/kg/dose**
- תדירות: כל **2-4 שעות**
- במקרים של טולרנטיות: עד **4 mcg/kg/dose**

**ילדים:**
💉 **1-2 mcg/kg/dose**
- תדירות: כל **30-60 דקות**
- במקרים של טולרנטיות: **25-50 mcg**

**מתבגרים עד 50 ק"ג:**
💉 **0.5-1 mcg/kg/dose**
- תדירות: כל **1-2 שעות**
- ישנם ילדים שיזדקקו למנות בתכיפות גבוהה יותר

**מתבגרים מעל 50 ק"ג:**
💉 **25-50 mcg/dose**
- תדירות: כל **1-2 שעות**
- ילדים מסוימים יזקקו למנות בתכיפות גבוהה יותר, עד **חצי שעה** הפרש בין מנה למנה

---

**תופעות לוואי:**

**נשימתיות:**
- דיכוי נשימתי **קל** (בפגים **משמעותי**)

**קרדיווסקולריות:**
- דיכוי קל של המיוקרד
- הרחבת כלי דם מועטה
- **ברדיקרדיה** (השפעה ב-CNS)

**אחרות:**
- פחות הפרשה של היסטמין (יחסית למורפין)
- **Chest Rigidity (חזה אבן)** - צ'אסט ריגידיטי""",
            "order_index": 3
        },
        {
            "title": "רקורוניום - Rocuronium",
            "section_type": "text",
            "content": """**Rocuronium - רקורוניום**

**תיאור:**
**משתק שרירים** (Neuromuscular Blocker)

**התוויות:**
- **פרה אינטובציה בילדים** ← חובה!
- שיתוק שרירים לילדים מונשמים
- טיפול בילדים עם **יתר לחץ דם ריאתי**

---

**🚨 כלל זהב:**
**לא תתבצע אינטובציה ללא מתן רקורוניום** טרם הפרוצדורה

---

**💉 RSI - Rapid Sequence Intubation:**
(אינטובציה מהירה ללא המתנה לעליית סטורציה)

**מינון בילדים:**
**1 mg/kg**

---

**💧 רקורוניום במתן מתמשך:**
**7-12 mcg/kg/minute**

**התוויות למתן מתמשך:**
- ילדים עם **יתר לחץ דם ריאתי**
- ילדים **המתנגדים להנשמה**

---

**⚠️ חשוב לזכור!**

מכיוון שאין דרך להעריך כאב ע"י אומדן:
🧠 **הערכת כאב תתבצע באמצעות ניטור פעילות מוחית רציף ע"י BIS**

---

**תופעות לוואי עיקריות:**
- מעלה תנגודת פריפרית

---

**🚨 דגשים סיעודיים ורפואיים:**

⏱️ **מהרגע שנותנים רקורוניום יש 30-40 שניות עד שהילד לא נושם**
← חייבים להכניס טובוס!

🔴 **דגש חשוב:**
**חובה לתת הרגעה** של **מידזולם או קטמין** לפני שיתוק!

💡 הילד לא יכול לזוז, אך הוא **מודע לחלוטין** אם לא ניתנה סדציה!""",
            "order_index": 4
        },
        {
            "title": "נלוקסון (נרקן) - Naloxone",
            "section_type": "text",
            "content": """**Naloxone (Narcan) - נלוקסון / נרקן**

**מנגנון:**
**חוסם קולטנים אופיואידיים** ← לא מאפשר לאופיאטים אגוניסטים להפעיל אותם

**התוויה:**
**אנטידוט להרעלת אופיאטים** (מורפין, פנטניל וכו')

---

**⏱️ פרמקוקינטיקה:**

- תחילת השפעה: **30 שניות**
- משך השפעה: **שעה - שעתיים**

⚠️ **חשוב:**
בגלל השפעה **קצרה יחסית לאופיאטים** ← ייתכן צורך ב**מנות חוזרות** כדי למנוע שקיעה חוזרת של המטופל

---

**📊 מינון:**

**עד גיל 5 או עד 20 ק"ג:**
💉 **0.1 mg/kg**

**מגיל 5 או מעל 20 ק"ג:**
💉 **2 mg/dose**

---

**מטבוליזם:**
נלוקסון עובר מטבוליזם ב**כבד**

---

**תופעות לוואי:**

**נוירולוגיות:**
- כאבי ראש
- סחרחורות
- **פרכוסים** (נדיר)

**קרדיווסקולריות:**
- **טכיקרדיה**
- ירידת לחץ דם

**גסטרואינטסטינאליות:**
- בחילות והקאות

---

**⚠️ זהירות:**
**זהירות בחולים קרדיאלים** - עלולה לגרום לעומס על הלב""",
            "order_index": 5
        },
        {
            "title": "תיאופנטל (פנטוטל) - Thiopental",
            "section_type": "text",
            "content": """**Thiopental (Pentothal) - תיאופנטל / פנטוטל**

**משפחה:** ברביטורטים

**תיאור:**
- פועל **מהר** (תוך **30 שניות**)
- לטווח **קצר** (**5-10 דקות**)

**התוויות:**
- **הרדמה מהירה לקראת אינטובציה** (RSI - Rapid Sequence Intubation)
- **טראומת ראש** (הורדת ICP)

---

**📊 מינון:**

**מתן IV:**
- **Infants:** 5-8 mg/kg
- **Children (1-12):** 5-6 mg/kg
- **מינון כללי:** 5 mg/kg

**במקרה של עליית ICP:**
ניתן **פוש** במינון של **חצי מדף החייאה**

---

**תופעות לוואי:**

**קרדיווסקולריות:**
- **הרחבת כלי דם**
- **דיכוי פעילות לבבית** (Myocardial Depression)
- ← גורמים ל**ירידת לחץ דם סיסטולי**

**אלרגיות:**
- משחרר **היסטמין**
- עלול להחמיר את ירידת לחץ הדם

**נשימתיות:**
- במטופלים עם **אסטמה** או **ברונכוספאזם** ← עלולה לגרום ל**היצרות דרכי נשימה**

---

**💡 שימוש:**
בשימוש במצבים של **טראומת ראש** - המינון למטה להשראת שינה והורדת ICP""",
            "order_index": 6
        },
        {
            "title": "פרופופול - Propofol",
            "section_type": "text",
            "content": """**Propofol - פרופופול**

**תיאור:**
- מנגנון פעולה **לא ברור**
- מוריד **מטבוליזם מוחי**

**שימוש:**
- לפרוצדורות קצרות במטופלים לא מונשמים
- לפני אקסטובציות

---

**📊 מינון:**

**בילדים בגילאי 3-16:**
💉 **2.5-3.5 mg/kg** במתן IV במשך **20-30 שניות**

**במתן מתמשך (מגיל חודשיים ומעלה):**
💧 **125-300 mcg/kg/minute**

---

**⏱️ פרמקוקינטיקה:**
- השפעה תוך: **40 שניות**
- משך השפעה: **5-15 דקות**

---

**✅ יתרונות:**
- נחשבת **לבטוחה** בחולים עם נטייה ליתר חום ממאיר

---

**⚠️ תופעות לוואי:**

**נשימתיות:**
- **אפניאה** (הפסקת נשימה)

**קרדיווסקולריות:**
- **ירידת לחץ דם**
- **ברדיקרדיה**

**מקומיות:**
- **כאב במקום ההזרקה**
- **שורף בווריד**

**אחרות:**
- זיהום (אמולסיה שומנית)
- בחילות והקאות (בהתעוררות)
- פריחה

---

**🚨 במתן ממושך:**
- ברדיקרדיה קשה עד **אסיסטולה**
- חמצת מטבולית קשה
- **רבדומיאוליזיס**
- היפרליפידמיה
- כבד שומני

---

**⚠️ זהירות והכנה:**

🧴 **הכנה סטרילית חובה!**

⚠️ **זהירות** עם מטופלים עם בעיות של **מטבוליזם של שומן**""",
            "order_index": 7
        },
        {
            "title": "תרופות נוספות - סדציה",
            "section_type": "text",
            "content": """**תרופות סדציה נוספות:**

---

**דקסמדטומידין - Dexmedetomidine:**

**משפחה:** אגוניסט אלפא אדרנרגי

**מינון בילדים:**
- מנת העמסה: **0.5-1 mcg/kg/dose** במשך **10 דקות**
- מנת אחזקה: **0.2-0.5 mcg/kg/dose** עד לתוצאה הנדרשת

**תופעות לוואי:**
- היפוטנסיביות
- ברדיקרדיה

---

**אטומידייט - Etomidate:**

**התוויה:** אנסטזיה (הרדמה)

**מינון בילדים:**
- עד גיל 10: **0.2-0.3 mg/kg/dose**
- מגיל 10 ומעלה: **0.3 mg/kg/dose**
  - טווח: 0.2-0.6 mg/kg/dose

**תופעות לוואי:**
- **פרכוסים (Myoclonus)**
- **דיכוי בלוטת האדרנל**
- בחילות והקאות
- כאב באזור ההזרקה
- ניסטגמוס
- גיהוקים

---

**ואליום (דיאזפם) - Diazepam:**

**משפחה:** בנזודיאזפין

**התוויות:** הרגעה, אנטי פרכוסי, נוגד חרדה

**מינון PO (מגיל חצי שנה ומעלה):**
💊 **0.2-0.5 mg/kg**
- מקסימום: **10 mg**

**מינון IV בילדים:**
💉 **0.05-0.1 mg/kg** במשך **3-5 דקות**
- להעלות מינון בהדרגה עד לאפקט הרצוי
- מקסימום: **0.25 mg/kg**

**מינון IV במתבגרים:**
💉 **5 mg**
- במידת הצורך: **2.5 mg נוספים**

**תופעות לוואי:**
- **נומה (ישנוניות)**

---

**פרומתזין (פנרגן) - Promethazine:**

**משפחה:** אנטיהיסטמיני

**התוויות:**
- נוגד בחילות והקאות
- מרגיע
- לאחר ניתוח, כימותרפיה
- תסמונת הקאות מחזוריות
- מיגרנות

**מינון (מגיל שנתיים ומתבגרים):**
💉 **0.25-0.5 mg/kg/dose** כל **4-6 שעות** לפי צורך
- ישנם ילדים הזקוקים למינון גבוה יותר: **1.1 mg/kg/dose**

**תופעות לוואי (פנותיאזינים):**
- טשטוש ראייה
- בלבול
- עצירות
- עין יבשה
- אצירת שתן
- **זרוסטומיה (יובש בפה)**""",
            "order_index": 8
        },
        {
            "title": "נקודות מפתח - סדציה והרדמה",
            "section_type": "text",
            "content": """**🎯 נקודות מפתח:**

✅ **מידזולם:** 0.05-0.1 mg/kg. זהירות מתחת לגיל 6 חודשים. נזאלי: 0.2 mg/kg

✅ **קטמין:** 1 mg/kg. לא מדכא נשימה. לא משפיע על ICP (שובר מיתוס!)

✅ **מורפין:** 0.05-0.2 mg/kg. אנטידוט: נלוקסון. זהירות בטראומת ראש

✅ **פנטניל:** 1-2 mcg/kg. זמן קצר (30 דקות). מתאים להלם והלם היפוולמי

✅ **רקורוניום:** 1 mg/kg ל-RSI. חובה סדציה לפני! (מידזולם/קטמין)

✅ **נלוקסון:** 0.1 mg/kg (עד 20 ק"ג) או 2 mg (מעל 20 ק"ג). אנטידוט לאופיאטים

✅ **תיאופנטל:** 5-8 mg/kg. מהיר (30 שניות), קצר (5-10 דקות)

✅ **פרופופול:** 2.5-3.5 mg/kg. שורף בווריד. זהירות במתן ממושך""",
            "order_index": 9
        },
        {
            "title": "אזהרות קריטיות",
            "section_type": "text",
            "content": """**🚨 אזהרות חשובות:**

🔴 **רקורוניום:** חובה סדציה (מידזולם/קטמין) לפני שיתוק! 30-40 שניות לאינטובציה

🔴 **מידזולם:** זהירות מיוחדת מתחת לגיל 6 חודשים (דיכוי נשימתי)

🔴 **מורפין:** זהירות בטראומת ראש (אגירת CO₂ ← עליית ICP)

🔴 **קטמין:** ריור מוגבר ← נותנים אטרופין באינטובציה

🔴 **נלוקסון:** השפעה קצרה (1-2 שעות) ← עלולים להזדקק למנות חוזרות

🔴 **תיאופנטל:** משחרר היסטמין. מדכא לב. זהירות באסטמה

🔴 **פרופופול:** במתן ממושך ← ברדיקרדיה, אסיסטולה, חמצת, רבדומיאוליזיס

🔴 **אטומידייט:** דיכוי אדרנל. אסור בשוק ספטי""",
            "order_index": 10
        },
        {
            "title": "פנינים קליניות",
            "section_type": "text",
            "content": """**💎 פנינים קליניות:**

💎 **רקורוניום:** BIS monitor לניטור פעילות מוחית (אין אומדן כאב כשמשותק!)

💎 **קטמין:** מצוין ל-TBI - לא משפיע על ICP (למרות מיתוס ישן)

💎 **פנטניל:** העדפה על מורפין במצבי הלם (פחות דיכוי המודינמי)

💎 **מידזולם נזאלי:** מזרק ייעודי למתן נזאלי. ניתן לחזור אחרי 15 דקות

💎 **מורפין:** קיטריל למניעת בחילות (לא לפרמין - דיסטוניה). מרככי צואה לעצירות

💎 **נלוקסון:** תחילת פעולה 30 שניות אך משך קצר - היזהר משקיעה חוזרת

💎 **פרופופול:** אמולסיה שומנית ← הכנה סטרילית חובה. שורף בווריד

💎 **RSI:** רקורוניום חובה לפני אינטובציה. 30-40 שניות עד תחילת פעולה

💎 **גמילה ממידזולם:** בקרוב פרוטוקול למניעת תסמונת גמילה

💎 **קטמין אוראלי:** יעיל בפציעות וכוויות בילדים מתחת לגיל 8""",
            "order_index": 11
        }
    ]
    
    # הוספת כל המקטעים
    print(f"\n📚 מוסיף {len(sections)} מקטעים...")
    
    for idx, section_data in enumerate(sections, 1):
        section_data['topic_id'] = topic_id
        
        section = create_content_section(section_data)
        
        if section:
            print(f"   ✅ מקטע {idx}/{len(sections)}: {section_data['title']}")
        else:
            print(f"   ❌ שגיאה במקטע {idx}: {section_data['title']}")
            return False
    
    return True

if __name__ == "__main__":
    print("="*60)
    print("💉 הוספת תוכן: סדציה והרדמה")
    print("="*60)
    
    try:
        success = add_sedation_medications()
        
        if success:
            print("\n🎉 הושלם בהצלחה!")
            print("\n💡 התוכן כולל:")
            print("   - מידזולם (דורמיקום)")
            print("   - קטמין")
            print("   - מורפין")
            print("   - פנטניל")
            print("   - רקורוניום")
            print("   - נלוקסון (נרקן)")
            print("   - תיאופנטל (פנטוטל)")
            print("   - פרופופול")
            print("   - תרופות נוספות")
        else:
            print("\n❌ הייתה בעיה בהוספת התוכן")
    
    except Exception as e:
        print(f"\n❌ שגיאה: {e}")
        import traceback
        traceback.print_exc()
