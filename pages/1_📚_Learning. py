import streamlit as st
import json
from datetime import datetime

st.set_page_config(page_title="×œ××™×“×”", page_icon="ğŸ“š", layout="wide")

# CSS ×œ×¢×‘×¨×™×ª
st.markdown("""
<style>
    . stApp {
        direction: rtl;
    }
    .topic-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 10px;
        margin: 1rem 0;
    }
    .content-box {
        background: #f7f7f7;
        padding: 1.5rem;
        border-radius: 8px;
        margin:  1rem 0;
        border-left: 4px solid #667eea;
    }
</style>
""", unsafe_allow_html=True)

st.title("ğŸ“š ××¨×›×– ×”×œ××™×“×”")
st.markdown("---")

# ×¨×©×™××ª × ×•×©××™×
topics = {
    "×”×—×™×™××” - BLS & PALS": {
        "icon": "ğŸš¨",
        "description": "×¤×¨×•×˜×•×§×•×œ×™ ×”×—×™×™××” ××ª×§×“××™× ×œ×™×œ×“×™×",
        "subtopics": ["××œ×’×•×¨×™×ª× PALS", "×ª×¨×•×¤×•×ª ×‘×”×—×™×™××”", "×“×¤×™×‘×¨×™×œ×¦×™×”", "Post-Arrest Care"]
    },
    "×”× ×©××” ××›× ×™×ª":  {
        "icon": "ğŸ’¨",
        "description": "××¡×˜×¨×˜×’×™×•×ª ×”× ×©××” ×‘×˜×™×¤×•×œ × ××¨×¥ ×™×œ×“×™×",
        "subtopics": ["××•×“×™× ×©×œ ×”× ×©××”", "PEEP", "×’××™×œ×” ××”× ×©××”", "NIV"]
    },
    "×ª×¨×•×¤×•×ª ×‘×˜×™×¤×•×œ × ××¨×¥": {
        "icon": "ğŸ’Š",
        "description": "×ª×¨×•×¤×•×ª ×§×¨×™×˜×™×•×ª ×•××™× ×•× ×™×",
        "subtopics": ["××™× ×•×˜×¨×•×¤×™×", "×¡×“×¦×™×”", "×× ×˜×™×‘×™×•×˜×™×§×”", "××œ×§×˜×¨×•×œ×™×˜×™×"]
    },
    "×”×œ× ×¡×¤×˜×™": {
        "icon":  "ğŸ¦ ",
        "description": "×–×™×”×•×™ ×•×˜×™×¤×•×œ ×‘×¡×¤×¡×™×¡ ×‘×™×œ×“×™×",
        "subtopics": ["Golden Hour", "×”×—×™×™××ª × ×•×–×œ×™×", "×•××–×•×¤×¨×¡×•×¨×™×", "Score Systems"]
    },
    "×˜×¨××•××” ×‘×™×œ×“×™×": {
        "icon": "ğŸš‘",
        "description": "×’×™×©×” ×œ×™×œ×“ ×”×¤×¦×•×¢",
        "subtopics": ["Primary Survey", "Secondary Survey", "×¤×’×™×¢×•×ª ×¨××©", "×¤×’×™×¢×•×ª ×‘×˜×Ÿ"]
    }
}

# ×‘×—×™×¨×ª × ×•×©×
col1, col2 = st. columns([1, 2])

with col1:
    st. subheader("ğŸ“‘ × ×•×©××™ ×œ××™×“×”")
    selected_topic = st.radio(
        "×‘×—×¨ × ×•×©×:",
        list(topics.keys()),
        label_visibility="collapsed"
    )

with col2:
    if selected_topic:
        topic_info = topics[selected_topic]
        
        # ×›×•×ª×¨×ª ×”× ×•×©×
        st.markdown(f"""
        <div class="topic-card">
            <h2>{topic_info['icon']} {selected_topic}</h2>
            <p>{topic_info['description']}</p>
        </div>
        """, unsafe_allow_html=True)
        
        # ×ª×ª×™ × ×•×©××™×
        st.subheader("×ª×ª×™ × ×•×©××™×:")
        tabs = st.tabs(topic_info['subtopics'])
        
        # ×ª×•×›×Ÿ ×œ×“×•×’××” - ×”×—×™×™××”
        if selected_topic == "×”×—×™×™××” - BLS & PALS": 
            with tabs[0]:  # ××œ×’×•×¨×™×ª× PALS
                st.markdown("""
                ### ××œ×’×•×¨×™×ª× PALS 2020
                
                #### 1ï¸âƒ£ ×”×¢×¨×›×” ×¨××©×•× ×™×ª
                - **×‘×“×™×§×ª ×ª×’×•×‘×ª×™×•×ª** - × ×’×™×¢×” ×•×§×¨×™××”
                - **×§×¨×™××” ×œ×¢×–×¨×”** - ×”×¤×¢×œ×ª ×§×•×“ 
                - **×‘×“×™×§×ª CAB** - Circulation, Airway, Breathing
                
                #### 2ï¸âƒ£ ×”×—×™×™××” ×‘×¡×™×¡×™×ª
                """)
                
                col1, col2 = st. columns(2)
                with col1:
                    st. info("""
                    **××˜×¤×œ ×™×—×™×“:**
                    - ×™×—×¡ 30:2
                    - 100-120 ×œ×—×™×¦×•×ª/×“×§×”
                    - ×¢×•××§:  1/3 ××¢×•××§ ×”×—×–×”
                    """)
                
                with col2:
                    st.success("""
                    **×©× ×™ ××˜×¤×œ×™×:**
                    - ×™×—×¡ 15:2
                    - ×”×—×œ×¤×” ×›×œ 2 ×“×§×•×ª
                    - ××™× ×™××•× ×”×¤×¡×§×•×ª
                    """)
                
                #### 3ï¸âƒ£ ×”×¢×¨×›×ª ×§×¦×‘
                st.warning("""
                **×§×¦×‘×™× ×”×“×•×¨×©×™× ×“×¤×™×‘×¨×™×œ×¦×™×”:**
                - VF - Ventricular Fibrillation
                - Pulseless VT
                
                **×× ×¨×’×™×”:**
                - ×¨××©×•×Ÿ: 2 J/kg
                - ×©× ×™ ×•××¢×œ×”: 4 J/kg
                """)
                
            with tabs[1]:  # ×ª×¨×•×¤×•×ª
                st.markdown("""
                ### ×ª×¨×•×¤×•×ª ×‘×”×—×™×™××”
                """)
                
                # ×˜×‘×œ×ª ×ª×¨×•×¤×•×ª
                drug_data = {
                    "×ª×¨×•×¤×”": ["××¤×™× ×¤×¨×™×Ÿ", "×××™×•×“×¨×•×Ÿ", "×œ×™×“×•×§××™×Ÿ", "×¡×™×“×Ÿ ×›×œ×•×¨×™×“", "× ×ª×¨×Ÿ ×‘×™×§×¨×‘×•× ×˜"],
                    "××™× ×•×Ÿ": [
                        "0.01 ××’/×§×’ IV/IO",
                        "5 ××’/×§×’ ×‘×•×œ×•×¡",
                        "1 ××’/×§×’",
                        "20 ××’/×§×’",
                        "1 mEq/kg"
                    ],
                    "×”×¢×¨×•×ª": [
                        "×›×œ 3-5 ×“×§×•×ª",
                        "×‘-VF/VT, × ×™×ª×Ÿ ×œ×—×–×•×¨ ×¤×¢××™×™×",
                        "×—×œ×•×¤×” ×œ×××™×•×“×¨×•×Ÿ",
                        "×¨×§ ×‘××™× ×“×™×§×¦×™×•×ª ×¡×¤×¦×™×¤×™×•×ª",
                        "×‘×—××¦×ª ××˜×‘×•×œ×™×ª ×§×©×”"
                    ]
                }
                
                st.table(drug_data)
                
            with tabs[2]:  # ×“×¤×™×‘×¨×™×œ×¦×™×”
                st.markdown("""
                ### ×“×¤×™×‘×¨×™×œ×¦×™×” ×‘×™×œ×“×™×
                
                #### ××ª×™ ×œ×‘×¦×¢ ×“×¤×™×‘×¨×™×œ×¦×™×”? 
                - VF ××• Pulseless VT
                - ××™×“ ×¢× ×–×™×”×•×™ ×”×§×¦×‘
                
                #### ××™× ×•×Ÿ ×× ×¨×’×™×”:
                1. **×× ×” ×¨××©×•× ×”:** 2 J/kg
                2. **×× ×•×ª × ×•×¡×¤×•×ª:** 4 J/kg (××§×¡×™××•× 10 J/kg ××• ××‘×•×’×¨)
                
                #### ×˜×›× ×™×§×”:
                """)
                
                col1, col2 = st.columns(2)
                with col1:
                    st.info("""
                    **××™×§×•× ×”×¤×“×œ×™×:**
                    - ×¤×“×œ ××—×“:  ×™××™×Ÿ ×¡×˜×¨× ×•× ×¢×œ×™×•×Ÿ
                    - ×¤×“×œ ×©× ×™: ×©×××œ ××¤×§×¡
                    - ××•:  ×§×“××™-××—×•×¨×™ ×‘×ª×™× ×•×§×•×ª
                    """)
                
                with col2:
                    st.warning("""
                    **×‘×˜×™×—×•×ª:**
                    - ×•×“× ×©××£ ××—×“ ×œ× × ×•×’×¢
                    - ×”×¡×¨ ×—××¦×Ÿ
                    - ×™×‘×© ××ª ×”×—×–×”
                    - ×”×¡×¨ ××“×‘×§×•×ª ×ª×¨×•×¤×ª×™×•×ª
                    """)
                    
            with tabs[3]:  # Post-Arrest
                st.markdown("""
                ### ×˜×™×¤×•×œ ×œ××—×¨ ×”×—×™×™××” ××•×¦×œ×—×ª
                
                #### ğŸ¯ ×™×¢×“×™× ××™×™×“×™×™×:
                1. **××•×¤×˜×™××™×–×¦×™×” ×”××•×“×™× ××™×ª**
                   - ×œ×—×¥ ×“× ×ª×§×™×Ÿ ×œ×’×™×œ
                   - ×ª×¤×•×§×ª ×©×ª×Ÿ >1 ××œ/×§×’/×©×¢×”
                   
                2. **×”× ×©××”**
                   - × ×•×¨××•×§×¤× ×™×” (PaCO2 35-45)
                   - SpO2 94-98%
                   
                3. **× ×•×™×¨×•×¤×¨×•×˜×§×¦×™×”**
                   - ×× ×¢ ×”×™×¤×¨×ª×¨××™×”
                   - ×©×§×•×œ ×”×™×¤×•×ª×¨××™×” ×˜×™×¤×•×œ×™×ª
                   - ×× ×¢ ×”×™×¤×•×’×œ×™×§××™×” ×•×”×™×¤×¨×’×œ×™×§××™×”
                   
                4. **×—×™×¤×•×© ×”×¡×™×‘×”**
                   - 4H's: Hypoxia, Hypovolemia, Hypo/Hyperkalemia, Hypothermia
                   - 4T's: Tension pneumothorax, Tamponade, Toxins, Thrombosis
                """)

# ×¤×× ×œ ×¦×“×“×™ - ×”×ª×§×“××•×ª
with st.sidebar:
    st.subheader("ğŸ“Š ×”×”×ª×§×“××•×ª ×©×œ×š")
    
    if 'completed_topics' not in st.session_state:
        st.session_state.completed_topics = []
    
    progress = len(st.session_state. completed_topics) / len(topics)
    st.progress(progress)
    st.write(f"×”×©×œ××ª {len(st. session_state.completed_topics)} ××ª×•×š {len(topics)} × ×•×©××™×")
    
    if st.button("âœ… ×¡××Ÿ × ×•×©× ×–×” ×›×”×•×©×œ×"):
        if selected_topic not in st.session_state.completed_topics:
            st.session_state.completed_topics.append(selected_topic)
            st.success("× ×•×©× ×¡×•××Ÿ ×›×”×•×©×œ×!")
            st.rerun()
    
    st.divider()
    
    # ×˜×™×¤ ×™×•××™
    st.info("""
    ğŸ’¡ **×˜×™×¤ ×”×™×•×:**
    
    ×–×›×•×¨ ××ª ×”-ABCDE approach:
    - Airway
    - Breathing  
    - Circulation
    - Disability
    - Exposure
    """)

# ×›×¤×ª×•×¨×™ × ×™×•×•×˜
st.divider()
col1, col2, col3 = st.columns(3)

with col2:
    if st.button("ğŸ“ ×¢×‘×•×¨ ×œ××‘×—×Ÿ ×¢×œ ×”× ×•×©×", type="primary", use_container_width=True):
        st.switch_page("pages/2_ğŸ“_Quiz.py")
