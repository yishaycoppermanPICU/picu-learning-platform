#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
הוספת תוכן: משככי כאב (Analgesics)
"""

from utils.database import init_supabase, create_content_item, create_content_section

def add_analgesics():
    """הוספת תרופות משככי כאב"""
    
    print("🔄 מתחבר למסד הנתונים...")
    supabase = init_supabase()
    
    if not supabase:
        print("❌ שגיאה בחיבור למסד נתונים")
        return False
    
    print("✅ חיבור הצליח!")
    
    # יצירת הנושא הראשי
    print("\n📝 יוצר נושא: משככי כאב...")
    
    topic_data = {
        "title": "משככי כאב - Analgesics",
        "category": "medications",
        "description": "מדריך מקיף למשככי כאב: פרצטמול, איבופרופן, דיפירון, קטורולק",
        "icon": "💊",
        "slug": "analgesics",
        "tags": ["תרופות", "משככי כאב", "פרצטמול", "איבופרופן", "דיפירון", "קטורולק", "אקמול", "נורופן"],
        "order_index": 9
    }
    
    topic = create_content_item(topic_data)
    
    if not topic:
        print("❌ שגיאה ביצירת הנושא")
        return False
    
    topic_id = topic['id']
    print(f"✅ נושא נוצר בהצלחה! ID: {topic_id}")
    
    # הוספת מקטעים
    sections = [
        {
            "title": "פרצטמול (אקמול) - Paracetamol (Acetaminophen)",
            "section_type": "text",
            "content": """**Paracetamol (Acetaminophen) - פרצטמול / אקמול**

**משפחה:** Analgesic & Antipyretic (משכך כאב ומוריד חום)

**מנגנון:**
מעכב סינתזה של פרוסטגלנדינים ב-CNS (מנגנון מדויק לא ידוע לחלוטין)

---

**📊 מינון:**

**PO (פומי):**
💊 **10-15 mg/kg/dose** כל **4-6 שעות**
- מקסימום למנה: **1000 mg** (1 גרם)
- מקסימום יומי: **75 mg/kg/day** (או **4000 mg/day**)

**PR (רקטלי):**
💊 **15-20 mg/kg/dose** כל **6-8 שעות**
- מינון גבוה יותר כי ספיגה פחות טובה

**IV (תוך ורידי):**
💉 **מתחת ל-50 ק"ג:** 15 mg/kg/dose כל **6 שעות**
💉 **מעל 50 ק"ג:** 1000 mg כל **6 שעות**
- או 650 mg כל **4 שעות**

---

**🎯 התוויות:**

✅ **חום** - **בחירה ראשונה בילדים!**
✅ **כאב קל-בינוני**
✅ **כאב ראש**
✅ **כאב שרירים ומפרקים**

---

**⏱️ פרמקולוגיה:**

**תחילת השפעה:**
- PO: **30-60 דקות**
- IV: **5-10 דקות**

**שיא השפעה:**
- PO: **1-3 שעות**

**משך השפעה:**
- **4-6 שעות**

**זמן מחצית חיים:**
- **2-4 שעות** (בוגרים)
- **2-2.5 שעות** (ילדים)

---

**✅ יתרונות:**

✅ **בטוח מאוד** (במינונים טיפוליים)
✅ **אין פגיעה בקיבה** (להבדיל מ-NSAIDs)
✅ **אין פגיעה בכליות** (במינונים רגילים)
✅ **לא משפיע על קרישת דם**
✅ **מתאים לתינוקות וילדים**

---

**⚠️ תופעות לוואי:**

**במינונים טיפוליים:**
- **נדירות מאוד!**
- פריחה (נדיר)
- בחילות (נדיר)

**במינון יתר (הרעלה):**
- **הפטוטוקסיות** (רעילות כבד) - חמורה מאוד!
- בחילות, הקאות
- כאבי בטן
- אי-ספיקת כבד (24-72 שעות)

---

**🚨 הרעלת פרצטמול:**

**מינון רעיל:**
- **>150 mg/kg** במנה אחת (ילדים)
- **>7.5 גרם** במנה אחת (מבוגרים)
- או **>75 mg/kg/day** במשך מספר ימים

**סימנים (4 שלבים):**
1. **0-24 שעות:** בחילות, הקאות, חיוורון
2. **24-72 שעות:** כאבי בטן, עליית אנזימי כבד
3. **72-96 שעות:** אי-ספיקת כבד חריפה
4. **>5 ימים:** החלמה או מוות

**טיפול:**
🚨 **N-Acetylcysteine (NAC) - האנטידוט!**
💉 **מנת העמסה:** 150 mg/kg במשך 1 שעה
💧 **אחר כך:** 50 mg/kg במשך 4 שעות
💧 **אחר כך:** 100 mg/kg במשך 16 שעות

⏰ **Timing קריטי!** יעיל ביותר אם ניתן תוך **8-10 שעות** מההרעלה

---

**⚠️ זהירות:**

🚨 **מחלות כבד:** להפחית מינון ל-50-75% מהרגיל
🚨 **אלכוהול כרוני:** סיכון מוגבר להרעלה
🚨 **תת-תזונה:** סיכון מוגבר (מיצוי גלוטתיון)
🚨 **שילוב תכשירים:** הרבה תרופות מכילות פרצטמול - סכנת overdose!

---

**💡 פנינים קליניות:**

💎 **בחירה ראשונה לחום בילדים:** בטוח, יעיל, נוח

💎 **IV יקר:** השתמש רק אם אין PO/PR (פוסט ניתוח, הקאות)

💎 **שילוב עם איבופרופן:** יעיל יותר מכל אחד לבד (לכאב וחום)

💎 **מינון מקסימלי:** 75 mg/kg/day (לא 90!). הרבה מקורות מציינים 90 אך 75 יותר בטוח

💎 **שעון:** לא לעבור 4 גרם ביום במבוגרים (אפילו במשקל גבוה)

💎 **NAC:** יעיל אפילו אחרי 24 שעות, אבל הכי טוב תוך 8 שעות""",
            "order_index": 0
        },
        {
            "title": "איבופרופן (נורופן) - Ibuprofen",
            "section_type": "text",
            "content": """**Ibuprofen - איבופרופן / נורופן**

**משפחה:** NSAID (Non-Steroidal Anti-Inflammatory Drug)

**מנגנון:**
מעכב COX (Cyclooxygenase) ← מפחית סינתזה של פרוסטגלנדינים ← משכך כאב, מוריד חום, אנטי-דלקתי

---

**📊 מינון:**

**חום / כאב:**
💊 **5-10 mg/kg/dose** כל **6-8 שעות**
- מקסימום למנה: **400 mg**
- מקסימום יומי: **40 mg/kg/day** (או **2400 mg/day**)

**Anti-inflammatory (דלקת):**
💊 **30-40 mg/kg/day** חלוקה ל-3-4 מנות
- למחלות שריר ומפרקים
- מקסימום: **2400 mg/day**

---

**🎯 התוויות:**

✅ **חום** - בעיקר אם פרצטמול לא יעיל
✅ **כאב קל-בינוני**
✅ **דלקת** (דלקות מפרקים, שרירים)
✅ **PDA (Patent Ductus Arteriosus)** בפגים
✅ **דיסמנוריאה** (כאבי וסת)

---

**⏱️ פרמקולוגיה:**

**תחילת השפעה:**
- **30-60 דקות**

**שיא השפעה:**
- **1-2 שעות**

**משך השפעה:**
- **6-8 שעות**

**זמן מחצית חיים:**
- **2-4 שעות**

---

**✅ יתרונות:**

✅ **אנטי-דלקתי** (להבדיל מפרצטמול)
✅ **יעיל לחום עקשני**
✅ **משך פעולה ארוך יותר** (6-8 שעות)

---

**⚠️ תופעות לוואי:**

**גסטרואינטסטינאליות:**
- **כאבי בטן** (שכיח)
- בחילות, הקאות
- **כיב פפטי** (שימוש ממושך)
- דימום GI

**כליות:**
- **אי-ספיקת כליות** (במיוחד בדהידרציה)
- אצירת נוזלים

**דם:**
- **פגיעה בקרישה** (מעכב טסיות)
- דימומים

**אלרגיות:**
- פריחה
- **ברונכוספאזם** (באסטמה רגישה)
- אנפילקסיס (נדיר)

**אחרות:**
- כאב ראש, סחרחורת
- עליית לחץ דם (קל)

---

**⚠️ זהירות:**

🚨 **דהידרציה:** סיכון גבוה לאי-ספיקת כליות
🚨 **אסטמה:** עלול לגרום לברונכוספאזם (~10% מהחולים)
🚨 **הלם / היפוולמיה:** אסור! (סיכון לכליות)
🚨 **דימום / כיב פפטי:** זהירות רבה
🚨 **מחלת לב:** עלול להחמיר אי-ספיקת לב
🚨 **ניתוח:** להפסיק 1-2 ימים לפני (פגיעה בקרישה)

---

**⚠️ התוויות נגד:**

❌ **דהידרציה / היפוולמיה**
❌ **אי-ספיקת כליות**
❌ **כיב פפטי פעיל**
❌ **דימום פעיל**
❌ **אי-ספיקת לב חמורה**
❌ **אלרגיה ל-NSAIDs**
❌ **תינוקות מתחת לגיל 6 חודשים** (בד"כ)

---

**💡 פנינים קליניות:**

💎 **שילוב עם פרצטמול:** 
- יעיל יותר מכל אחד לבד
- לחילופין (staggered): פרצטמול שעה 0, איבופרופן שעה 3, פרצטמול שעה 6...

💎 **עם אוכל:** לקחת עם אוכל (הפחתת גירוי קיבה)

💎 **דהידרציה = התווית נגד:** תמיד לוודא הידרציה טובה לפני מתן

💎 **אסטמה:** ~90% מחולי אסטמה סובלים איבופרופן ללא בעיה. 10% רגישים

💎 **PDA בפגים:** מינון מיוחד להצרת ductus arteriosus פתוח

💎 **חום עקשני:** איבופרופן יעיל יותר מפרצטמול בחלק מהמקרים""",
            "order_index": 1
        },
        {
            "title": "דיפירון (נובלגין) - Dipyrone (Metamizole)",
            "section_type": "text",
            "content": """**Dipyrone (Metamizole, Novalgin) - דיפירון / נובלגין / מטמיזול**

**משפחה:** NSAID (פירזולון)

**מנגנון:**
מעכב COX + אפקט מרכזי על תרמורגולציה

---

**📊 מינון:**

**PO/IV/IM:**
💊 **10-15 mg/kg/dose** כל **6-8 שעות**
- מקסימום למנה: **1000 mg** (1 גרם)
- מקסימום יומי: **60 mg/kg/day** (או **4000 mg/day**)

**IV - מתן איטי:**
💉 לתת לאט במשך **5-10 דקות** (מניעת היפוטנסיה)

---

**🎯 התוויות:**

✅ **חום גבוה עקשני** - יעיל מאוד!
✅ **כאב בינוני-חמור**
✅ **כאב פוסט-אופרטיבי**
✅ **כאב בטן (קוליק)**

---

**⏱️ פרמקולוגיה:**

**תחילת השפעה:**
- PO: **30-60 דקות**
- IV: **10-20 דקות**

**משך השפעה:**
- **6-8 שעות**

---

**✅ יתרונות:**

✅ **יעיל מאוד להורדת חום**
✅ **משכך כאב חזק**
✅ **פחות פגיעה בקיבה** (יחסית ל-NSAIDs אחרים)

---

**⚠️ תופעות לוואי:**

**חמורות (נדירות):**
- **אגרנולוציטוזיס** (ירידה חמורה בלויקוציטים) - **1:1,000,000**
- אנמיה אפלסטית (נדיר מאוד)
- תגובות אלרגיות (אנפילקסיס)

**שכיחות:**
- **היפוטנסיה** (במתן IV מהיר)
- בחילות
- פריחה

---

**🚨 אגרנולוציטוזיס:**

**סימנים:**
- חום, צמרמורות
- דלקות פה וגרון חמורות
- זיהומים חוזרים

**ניטור:**
במטופלים בסיכון (שימוש ממושך) - ספירת דם תקופתית

---

**⚠️ זהירות:**

🚨 **מתן IV מהיר:** סכנת היפוטנסיה חמורה! תמיד לאט (5-10 דקות)
🚨 **אסטמה:** עלול לגרום לברונכוספאזם
🚨 **אלרגיה:** תגובות אלרגיות אפשריות
🚨 **היפוטנסיה:** זהירות במטופלים עם לחץ דם נמוך

---

**⚠️ התוויות נגד:**

❌ **הפרעות דם** (לויקופניה, אנמיה)
❌ **אלרגיה לדיפירון או NSAIDs**
❌ **G6PD deficiency** (מחסור באנזים)
❌ **פורפיריה**
❌ **הריון** (טרימסטר שלישי)

---

**💡 פנינים קליניות:**

💎 **חום עקשני גבוה:** דיפירון מהיעילים ביותר להורדת חום

💎 **מתן IV איטי חובה!** מהיר = היפוטנסיה

💎 **אגרנולוציטוזיס:** סיכון נמוך מאוד (1:1,000,000) אך חמור

💎 **נפוץ באירופה ולטינית:** פחות בשימוש בארה"ב ובריטניה (נסוג מהשוק)

💎 **ישראל:** בשימוש נרחב, נחשב בטוח יחסית

💎 **שילוב עם פרצטמול:** אפשרי ויעיל (מנגנונים שונים)

---

**⚠️ הערה חשובה:**

🔴 דיפירון נסוג מהשוק במדינות מסוימות (ארה"ב, בריטניה) בשל חשש מאגרנולוציטוזיס. עדיין בשימוש בישראל, אירופה ולטינית אמריקה עם מעקב.""",
            "order_index": 2
        },
        {
            "title": "קטורולק - Ketorolac",
            "section_type": "text",
            "content": """**Ketorolac - קטורולק**

**משפחה:** NSAID (Non-Steroidal Anti-Inflammatory Drug)

**תיאור:**
NSAID חזק במיוחד למשכך כאב, בעוצמה דומה לאופיאטים חלשים

---

**📊 מינון:**

**IV/IM:**
💉 **0.5 mg/kg/dose** כל **6 שעות**
- מקסימום למנה: **15-30 mg** (תלוי גיל ומשקל)
- מקסימום יומי: **60-90 mg/day**

**PO:**
💊 **0.25 mg/kg/dose** כל **6 שעות**
- מקסימום: **10 mg/dose**

**⏰ משך טיפול מקסימלי:**
🚨 **5 ימים!** (IV + PO ביחד)

---

**🎯 התוויות:**

✅ **כאב פוסט-אופרטיבי בינוני-חמור**
✅ **כאב חריף חמור**
✅ **אלטרנטיבה לאופיאטים**

❌ **לא לטיפול כרוני!** (מקסימום 5 ימים)

---

**⏱️ פרמקולוגיה:**

**תחילת השפעה:**
- IV: **10-15 דקות**
- PO: **30-60 דקות**

**שיא השפעה:**
- IV: **1-2 שעות**

**משך השפעה:**
- **4-6 שעות**

---

**✅ יתרונות:**

✅ **חזק מאוד** - דומה למורפין במינונים נמוכים
✅ **אין דיכוי נשימתי** (להבדיל מאופיאטים)
✅ **אין התמכרות**
✅ **אפקט חוסך אופיאטים** (Opioid-sparing)

---

**⚠️ תופעות לוואי:**

**גסטרואינטסטינאליות:**
- **כאבי בטן** (שכיח)
- בחילות, הקאות
- **כיב פפטי, דימום GI** (במיוחד בשימוש ממושך)

**כליות:**
- **אי-ספיקת כליות חריפה** (סיכון גבוה!)
- אצירת נוזלים
- עליית אוריאה וקריאטינין

**דימום:**
- **פגיעה בקרישה** (מעכב טסיות)
- **דימומים** (במיוחד פוסט-ניתוח)
- המטומות

**אחרות:**
- כאב ראש
- סחרחורת
- כאב במקום ההזרקה

---

**🚨 אזהרות חמורות:**

🔴 **מקסימום 5 ימים!** טיפול ארוך יותר ← סיכון גבוה לסיבוכים
🔴 **דימום פוסט-אופרטיבי:** סיכון משמעותי
🔴 **אי-ספיקת כליות:** סיכון גבוה, במיוחד בדהידרציה
🔴 **כיב פפטי:** עלול להחמיר או לגרום לדימום

---

**⚠️ התוויות נגד:**

❌ **סיכון גבוה לדימום**
❌ **ניתוח עם סיכון דימום גבוה** (טונזילקטומי, כירורגיה פלסטית)
❌ **אי-ספיקת כליות**
❌ **כיב פפטי פעיל**
❌ **דהידרציה**
❌ **היפוולמיה**
❌ **אסטמה חמורה**
❌ **אלרגיה ל-NSAIDs**

---

**⚠️ זהירות מיוחדת:**

🚨 **טונזילקטומיה:** התווית נגד! סיכון גבוה לדימום
🚨 **ניתוח לב:** זהירות רבה
🚨 **דהידרציה:** וודא הידרציה טובה
🚨 **קשישים:** סיכון גבוה יותר
🚨 **משקל נמוך:** התאמת מינון

---

**💡 פנינים קליניות:**

💎 **Opioid-sparing:** מצוין להפחתת שימוש באופיאטים פוסט-ניתוח

💎 **5 ימים מקסימום:** חובה! לא יותר (IV + PO ביחד)

💎 **דימום פוסט-ניתוח:** תמיד לשקול סיכון-תועלת

💎 **טונזילקטומיה:** אסור! (FDA black box warning)

💎 **כליות:** בדיקת תיפקוד כליות לפני ובמהלך טיפול

💎 **עוצמה:** 30 mg ketorolac ≈ 10 mg morphine

💎 **שילוב עם אופיאטים:** אפשרי ויעיל, מפחית מינון אופיאטים

---

**⚠️ FDA Black Box Warnings:**

🔴 **סיכון גבוה לדימום GI, כיבים, פרפורציה**
🔴 **סיכון לאירועים קרדיווסקולריים**
🔴 **אסור בטיפול פרי- ופוסט-אופרטיבי ב-CABG**
🔴 **מקסימום 5 ימים!**""",
            "order_index": 3
        },
        {
            "title": "נקודות מפתח - משככי כאב",
            "section_type": "text",
            "content": """**🎯 נקודות מפתח:**

✅ **פרצטמול:** 10-15 mg/kg כל 4-6 שעות. מקס 75 mg/kg/day. בטוח מאוד, בחירה ראשונה

✅ **איבופרופן:** 5-10 mg/kg כל 6-8 שעות. מקס 40 mg/kg/day. אנטי-דלקתי. זהירות בדהידרציה!

✅ **דיפירון:** 10-15 mg/kg כל 6-8 שעות. יעיל מאוד לחום. מתן IV איטי (5-10 דקות)!

✅ **קטורולק:** 0.5 mg/kg IV/IM כל 6 שעות. חזק מאוד. מקסימום 5 ימים!

✅ **שילוב פרצטמול + איבופרופן:** יעיל יותר מכל אחד לבד

✅ **NAC (אנטידוט פרצטמול):** 150 mg/kg loading. יעיל ביותר תוך 8 שעות

✅ **מינון רעיל פרצטמול:** >150 mg/kg במנה אחת או >75 mg/kg/day כרוני""",
            "order_index": 4
        },
        {
            "title": "אזהרות קריטיות",
            "section_type": "text",
            "content": """**🚨 אזהרות חשובות:**

🔴 **פרצטמול הרעלה:** >150 mg/kg במנה. הפטוטוקסיות קטלנית! NAC תוך 8 שעות

🔴 **פרצטמול מינון יומי:** מקסימום 75 mg/kg/day (לא 90!). 4 גרם/day במבוגרים

🔴 **איבופרופן דהידרציה:** התווית נגד! סכנת אי-ספיקת כליות חריפה

🔴 **איבופרופן אסטמה:** ~10% רגישים ← ברונכוספאזם. זהירות!

🔴 **דיפירון מתן IV מהיר:** היפוטנסיה חמורה! תמיד לאט (5-10 דקות)

🔴 **דיפירון אגרנולוציטוזיס:** נדיר (1:1,000,000) אך קטלני. ספירת דם בשימוש ממושך

🔴 **קטורולק 5 ימים:** מקסימום! טיפול ארוך ← כיב פפטי, אי-ספיקת כליות, דימום

🔴 **קטורולק טונזילקטומיה:** אסור מוחלט! (FDA Black Box) סיכון דימום גבוה

🔴 **NSAIDs בהיפוולמיה/הלם:** אסור! סכנת אי-ספיקת כליות""",
            "order_index": 5
        },
        {
            "title": "פנינים קליניות",
            "section_type": "text",
            "content": """**💎 פנינים קליניות:**

💎 **Multimodal Analgesia:** שילוב מספר משככי כאב (פרצטמול + NSAID + אופיאט במידת הצורך)

💎 **פרצטמול + איבופרופן לחילופין:** פרצטמול שעה 0, איבופרופן שעה 3, פרצטמול שעה 6...

💎 **פרצטמול IV יקר:** השתמש רק אם אין PO/PR (פוסט ניתוח, הקאות)

💎 **איבופרופן עם אוכל:** תמיד עם אוכל (הפחתת גירוי קיבה)

💎 **דיפירון חום גבוה:** אחד היעילים ביותר להורדת חום עקשני

💎 **קטורולק Opioid-sparing:** מצוין להפחתת אופיאטים פוסט-ניתוח

💎 **קטורולק עוצמה:** 30 mg ≈ 10 mg morphine

💎 **NAC טיפול פרצטמול:** יעיל אפילו אחרי 24 שעות, אבל הכי טוב תוך 8 שעות

💎 **פרצטמול שילוב תכשירים:** הרבה תרופות מכילות פרצטמול - סכנת overdose!

💎 **איבופרופן PDA בפגים:** מינון מיוחד להצרת ductus arteriosus פתוח

💎 **דיפירון ישראל vs ארה"ב:** נפוץ בישראל, נסוג בארה"ב (חשש אגרנולוציטוזיס)

💎 **כליות ו-NSAIDs:** תמיד לוודא הידרציה טובה. בדיקת תיפקוד כליות בסיכון גבוה""",
            "order_index": 6
        }
    ]
    
    # הוספת כל המקטעים
    print(f"\n📚 מוסיף {len(sections)} מקטעים...")
    
    for idx, section_data in enumerate(sections, 1):
        section_data['topic_id'] = topic_id
        
        section = create_content_section(section_data)
        
        if section:
            print(f"   ✅ מקטע {idx}/{len(sections)}: {section_data['title']}")
        else:
            print(f"   ❌ שגיאה במקטע {idx}: {section_data['title']}")
            return False
    
    return True

if __name__ == "__main__":
    print("="*60)
    print("💊 הוספת תוכן: משככי כאב")
    print("="*60)
    
    try:
        success = add_analgesics()
        
        if success:
            print("\n🎉 הושלם בהצלחה!")
            print("\n💡 התוכן כולל:")
            print("   - פרצטמול (Paracetamol)")
            print("   - איבופרופן (Ibuprofen)")
            print("   - דיפירון (Dipyrone)")
            print("   - קטורולק (Ketorolac)")
        else:
            print("\n❌ הייתה בעיה בהוספת התוכן")
    
    except Exception as e:
        print(f"\n❌ שגיאה: {e}")
        import traceback
        traceback.print_exc()
